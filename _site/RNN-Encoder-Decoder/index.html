<!DOCTYPE html>
<html lang="en-us">
<head>
  <head>
  <!-- Description of Blog -->
  <meta name="description" content="Python, Machine & Deep Learning">
  <link rel="canonical" href="https://greeksharifa.github.io/">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Python, Machine & Deep Learning">
  <meta property="og:description" content="Python, Machine Learning & Deep Learning 설명서">
  <meta property="og:image" content="https://greeksharifa.github.io/public/img/icon-144x144.png">
  <meta property="og:url" content="https://greeksharifa.github.io/">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Python, Machine & Deep Learning">
  <meta name="twitter:description" content="Python, Machine Learning & Deep Learning 설명서">
  <meta name="twitter:image" content="https://greeksharifa.github.io/public/img/icon-144x144.png">
  <meta name="twitter:domain" content="https://greeksharifa.github.io/">

  <!-- link -->
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      RNN Encoder-Decoder
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/main.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="icon-144x144" sizes="144x144" href="/public/img/icon-144x144.png">
  <link rel="shortcut icon" href="/public/img/icon_32x32.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  
  <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_SVG"> </script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } });
  </script>
  

  <!-- Ads -->
  <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
  </script>
</head>

  <!-- for Google AdSense-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-9951774327887666",
    enable_page_level_ads: true
  });
</script>

  <style>blockquote {
    font-size: 1em;
    line-height: 1.4
  }</style>
  <link href='http://fonts.googleapis.com/css?family=Gill+Sans' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Consolas' rel='stylesheet' type='text/css'>
</head>
<body>

<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <div class="sidebar-personal-info">
      <div class="sidebar-personal-info-section">
        <a href="http://gravatar.com/3c2986ad7ac1f2230ea3596f44563328">
          <img src="/public/img/maple_tree.jpg" title="Cover Photo" alt="Maple tree" />
        </a>
      </div>
      <div class="sidebar-personal-info-section">
        <p><strong>Developer and Analyst</strong>, YW & YY.</p>
      </div>
      
      
      
      <div class="sidebar-personal-info-section">
        <p> Follow me:
        
        
        
        <a href="https://github.com/greeksharifa">
          <i class="fa fa-github" aria-hidden="true"></i>
        </a>
        
        |
        
        
        
        <a href="mailto:greeksharifa@gmail.com">
          <i class="fa fa-envelope" aria-hidden="true"></i>
        </a>
        
        
        
        </p>
      </div>
      
    </div>
  </div>

  <nav class="sidebar-nav">
    
      
      
      

      

      <span class="">
        <a class="sidebar-nav-item " href="/">
          Home
        </a>

        
      </span>

    
      
      
      

      

      <span class="foldable">
        <a class="sidebar-nav-item " href="/blog/">
          Blog
        </a>

        
          
            
            
            
              <a class="sidebar-nav-item sidebar-nav-item-sub " href="/blog/categories/">
                Categories
              </a>
          
        
          
            
            
            
              <a class="sidebar-nav-item sidebar-nav-item-sub " href="/blog/tags/">
                Tags
              </a>
          
        
      </span>

    
      
      
      

      

      <span class="">
        <a class="sidebar-nav-item " href="/about/">
          About
        </a>

        
      </span>

    
      
      
      

      

      <span class="">
        <a class="sidebar-nav-item " href="http://greeksharifa.github.io/">
          Github Project
        </a>

        
      </span>

    

  </nav>

  <div class="sidebar-item">
    <p>
    &copy; 2020 YW & YY. This work is liscensed under <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a>.
    </p>
  </div>

  <div class="sidebar-item">
    <p>
    Powered by <a href="http://jekyllrb.com">jekyll</a> and <a href="http://greeksharifa.github.io">YW & YY</a>
    </p>
  </div>
</div>


<!-- Wrap is the content to shift when toggling the sidebar. We wrap the
     content to avoid any CSS collisions with our real content. -->
<div class="wrap">
  <div class="masthead">
    <div class="container">
      <h3 class="masthead-title" align="center">
        <a href="/" title="Home" title="YW & YY">
          <img class="masthead-logo" src="/public/img/logo.png"/>
        </a>
        <small>YW & YY's Python, Machine & Deep Learning</small>
        <!-- HTML elements for search -->
        <a href="/search/" id="search_icon">
          <img src="/public/img/search.png" width="25" height="25"
               align="right" style="margin-top:5px; margin-bottom:0;"
               onmouseover="this.style.opacity=0.7" onmouseout="this.style.opacity=0.5"
               alt="search">
        </a>
      </h3>
    </div>
  </div>

  <div class="container content">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.9/styles/github.min.css"> 
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.9/highlight.min.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 수직형 디스플레이 광고1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9951774327887666"
     data-ad-slot="7237421728"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div class="post">
  <h1 class="post-title">RNN Encoder-Decoder</h1>
  <span class="post-date">10 Sep 2018</span>
   |
  
  <a href="/blog/tags/#rnn" class="post-tag">RNN</a>
  
  <a href="/blog/tags/#paper-review" class="post-tag">Paper_Review</a>
  
  
  <article>
    <p><strong>목차</strong></p>
    <ul>
  <li><a href="#learning-phrase-representations-using-rnn-encoder-decoder-for-statistical-machine-translation">Learning Phrase Representations using RNN Encoder-Decoder for Statistical Machine Translation</a></li>
</ul>

    <h3 id="learning-phrase-representations-using-rnn-encoder-decoder-for-statistical-machine-translation">Learning Phrase Representations using RNN Encoder-Decoder for Statistical Machine Translation</h3>
<blockquote>
  <p>본 글은 Kyunghyun Cho, Bart van Merrienboer, Caglar Gulcehre, Dzmitry Bahdanau, Fethi Bougares, Holger Schwenk, Yoshua Bengio가 2014년에 Publish한 위 논문을 리뷰한 것이다.</p>
</blockquote>

<p><strong>Abstract</strong><br />
Encoder의 역할은 a sequence of symbols를 고정된 길이의 vector representation으로 나타내는 것이고, Decoder의 역할은 그 representation을 다시 sequence of symbols로 나타내는 것이다.</p>

<p>두 모델은 jointly train되는데, 그 목적은 source sequence가 주어졌을 때,<br />
target sequence가 나타날 조건부 확률을 최대화하는 것이다.<br />
= (Maximize the conditional probability of a target sequence given a source sequence.)</p>

<p><strong>Introduction</strong><br />
본 논문은 SMT(Statistical Machine Translation)의 영역에서 모델을 분석하는 것을 주요 목적으로 하고 있다.</p>

<p>연구자들은 memor capacity와 학습 효율을 향상시키기 위해 다소 복잡한(sophiscated) Hidden Unit을 사용하였으며, 영어를 프랑스어로 번역하는 과정을 통해 그 성능을 평가하였다.</p>

<p>본 논문에서 제안한 RNN Encoder의 경우 phrase table에서 언어학적 규칙(regularities)을 잡아내는 역할을 수행하였으며 이는 사실 전반적인 번역 성능의 향상을 꾀하는 과정의 일부로 평가된다. Decoder의 경우 phrase의 continuous space representation을 학습하는데, 이는 phrase의 의미론적(semantic)이고 통사론적(syntactic) 구조를 저장하는 역할을 수행한다.</p>

<p><strong>RNN Encoder-Decoder</strong><br />
기본적인 RNN은 sequence에서 다음 symbol을 예측하는 방향으로 학습됨으로써 sequence의 확률 분포를 학습한다.<br />
이 때 시간t에 대한 output은 $ p(x_t | x_{t-1}, …, x_1) $와 같은 조건부 확률로 표현된다.<br />
따라서 sequence <strong>x</strong>의 확률은 아래와 같이 표현할 수 있다.</p>

<script type="math/tex; mode=display">p(x) = \prod_{t=1}^T p(x_t | x_{t-1}, ..., x_1)</script>

<p>(위 $p(x)$의 x는 <strong>x</strong> vector이며, 위와 같은 식으로 표현되는 이유는 곱셈정리에 의한 것임)<br />
이전의 symbol들에 근거하여 다음 symbol을 예측한다고 볼 수 있다.</p>

<p>본 논문에서 제안하는 RNN Encoder-Decoder 모델은 다소 새로운 구조를 갖고 있다. Encoder는 input sequence <strong>x</strong>의 원소 symbol들을 연속적으로 읽어 들인다.<br />
(reads each symbol of an input sequence <strong>x</strong> sequentially)</p>

<p>이 과정 속에서 시간 t의 hidden state는 아래와 같이 업데이트 된다.</p>

<script type="math/tex; mode=display">% <![CDATA[
h_{<t>} = f(h_{<t-1>}, x_t) %]]></script>

<p>즉, 이전 hidden state와 시간t의 새로운 input $x_t$에 의해 업데이트 되는 것이다.<br />
모든 reading이 끝나고 나서 나면 RNN의 hidden state는 모든 input sequence에 대한 summary <strong>c</strong>이다.</p>

<center><img src="/public/img/Paper_Review/2018-09-10-RNN-Encoder-Decoder/r1.jpg" width="50%" /></center>

<p>Decoder는 주어진 hidden state $h_{<t-1>}$을 바탕으로  
다음 symbol $ y_{<t>} $를 예측함으로써 output sequence를 생성하도록 학습된다.</t></t-1></p>

<p>다만 여기서 주목할 점은, 기본 RNN과 달리 새로운 hidden state는 summary <strong>c</strong>와<br />
이전 output symbol $ y_{t-1} $에도 conditioned 되어 있다는 것이다.<br />
즉 아래와 같이 표현될 수 있다.</p>

<script type="math/tex; mode=display">% <![CDATA[
h_{<t>} = f(h_{<t-1>}, y_{t-1}, c) %]]></script>

<p>다음 symbol의 조건부 확률 분포는 아래와 같이 나타낼 수 있다.</p>

<script type="math/tex; mode=display">% <![CDATA[
P(y_t | y_{t-1}, ..., y_1, c) = g(h_{<t>}, y_{t-1}, c) %]]></script>

<p>정리하자면, RNN Encoder-Decoder의 두 성분은 아래의 조건부 로그 가능도를 최대화하도록 결합하여 학습된다.</p>

<script type="math/tex; mode=display">\max_{\theta} {1 \over N} \sum_{n=1}^N log p_{\theta} (y_n|x_n)</script>

<p>여기서 $\theta$는 모델 parameter의 집합을 의미하며,<br />
$y_n$은 output sequence를 $x_n$은 input sequence를 의미한다.</p>

<p>이렇게 학습된 RNN Encoder-Decoder는 크게 2가지 방법으로 활용될 수 있다.</p>
<ol>
  <li>주어진 input sequence에 대해 새로운 target sequence를 생성할 수 있다.</li>
  <li>input &amp; output sequences 쌍의 적합성을 평가할 수 있다. (Score)</li>
</ol>

<p>2.3절인 <em>Hidden Unit that Adatively Remembers and Forgets</em>부분은 LSTM Unit의 기본 형식을 따르고 있기 때문에 식에 대한 리뷰는 생략하겠다. 다만 사용된 용어만을 살펴 보면 아래과 같다.</p>

<p>Reset Gate $r_j$, Update Gate $z_j$, Proposed Unit $h_j^{t}$</p>

<p>효과에 대해 설명하자면,</p>
<ol>
  <li>Reset Gate가 0에 가까워질 때, 시간 t의 <strong>Candidate hidden state</strong>는 이전 hidden state를 잊고(ignore, forget) 시간 t의 현재 input x로 Reset하게 된다.</li>
  <li>Updated Gate는 이전(시간 t-1) hidden state의 정보가 얼마나 현재(시간 t) hidden state에 영향을 줄 것인가를 결정한다. 이를 통해 lont-term 정보를 효과적으로 보존(rembember)한다.</li>
  <li>각각의 hidden unit은 Reset/Update Gate를 각각 갖고 있기 때문에, different time scales에 나타나는 종속성(dependencies)를 포착(capture)하는 법을 학습하게 된다. short-term dependencies를 포착하는 법을 학습한 unit들의 Reset Gate는 자주 활성화 될 것이며, long-term dependencies를 포착하는 법을 학습한 unit들의 Update Gate는 자주 활성화될 것이다.</li>
</ol>

<p><strong>Statistical Machine Translation: SMT</strong><br />
앞에서도 설명하였듯이 SMT의 기본 목표는 주어진 source sentence에 대하여 translation을 찾는 것이고, 식으로 표현하자면 아래와 같다.</p>

<script type="math/tex; mode=display">p(f|e) \propto p(e|f) * p(f)</script>

<p>일단 Phrase Pairs를 평가하는 측면에서 본 모델을 살펴보도록 하겠다.<br />
RNN Encoder-Decoder를 학습시킬 때, 기존 말뭉치들에서 각각의 phrase pair들의 출현 빈도는 고려하지 않는다.<br />
그 이유는 2가지로 풀이 된다.</p>
<ol>
  <li>계산량 감소를 위해서이다.</li>
  <li>본 모델이 단순히 출현빈도 Rank에 영향을 받지 않게 하기 위함이다.</li>
</ol>

<p>사실 phrase 속에 존재하는 translation probability는 이미 원래 corpus의 phrase pairs의 출현 빈도를 반영한다. 모델이 학습 과정 속에서 이러한 출현 빈도에 따른 어떤 규칙을 학습하는 것이 아니라, 언어학적 규칙(linguistic regularities)을 학습하도록 하는 것이 핵심이라고 할 수 있다.<br />
(learning the manifold of plausible translations)</p>

<p><strong>Experiments</strong><br />
대규모의 데이터가 구축되었지만 실제 학습을 위해서 본 논문의 저자는 source &amp; target vocab을 가장 자주 등장한 15,000개의 단어로 한정하였다. 이는 전체 데이터셋의 93%를 커버한다고 밝혔다.</p>

<p>학습과정에 대한 자세한 사항은 논문을 참조하기 바란다.</p>

<p><strong>Conclusion</strong><br />
결과적으로 RNN Encoder-Decoder는 phrase pairs 내에 있는 언어학적 규칙을 포착하고, 적절하게 구성된 target phrases 또한 제안하는 데에도 좋은 성능을 보이는 것으로 확인되었다.</p>

<p><strong>Structure of Encoder</strong><br />
source phrase X와 Y의 형태는 아래와 같다.</p>

<script type="math/tex; mode=display">X = (x_1, x_2, ... , x_N), Y = (y_1, y_2, ... , y_N)</script>

<p>X.shape = (N, K), Y.shape = (N, K)</p>

<p>물론 여기서 각 세로 벡터는 one-hot vector이다.<br />
source phrase의 각 단어는 500차원의 벡터로 임베딩된다.<br />
Encoder의 Hidden state는 1000개의 unit을 갖고 있다.<br />
(시간 t의 hidden state $h_{<t-1>}$의 shape = (1000, 1))</t-1></p>

<p>위 hidden state가 계산되는 과정을 살펴보면,</p>
<ol>
  <li>Reset Gate<br />
<script type="math/tex">% <![CDATA[
r = \sigma(W_r e(x_t) + U_r h_{<t-1>}) %]]></script></li>
</ol>

<p>(1000, 1) = (1000, 500) X (500, 1) + (1000, 1000) X (1000, 1)</p>

<ol>
  <li>Update Gate<br />
<script type="math/tex">% <![CDATA[
z = \sigma(W_z e(x_t) + U_z h_{<t-1>}) %]]></script></li>
</ol>

<p>shape은 위와 같다.</p>

<ol>
  <li>Candidate<br />
<script type="math/tex">% <![CDATA[
\tilde{h}^{<t>} = tanh(W e(x_t) + U(r \odot h_{<t-1>} )) %]]></script></li>
</ol>

<p>(1000, 1) = (1000, 500)X(500, 1) + (1000, 1000)X(1000, 1)$\odot$(1000, 1)</p>

<ol>
  <li>
    <p>Hidden State<br />
<script type="math/tex">% <![CDATA[
h^{<t>} = z h^{<t-1>} + (1-z) \tilde{h}^{<t>} %]]></script></p>
  </li>
  <li>
    <p>Representatino of the source phrase: 농축된 정보<br />
<script type="math/tex">% <![CDATA[
c = tanh(V h^{<t>}) %]]></script></p>
  </li>
</ol>

<p><strong>Structure of Decoder</strong><br />
Soon to be updated</p>


  </article>
  <script type="text/javascript" async
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  
  <script data-ad-client="ca-pub-9951774327887666" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</div>

<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-9951774327887666">
</amp-auto-ads>

<script data-ad-client="ca-pub-9951774327887666" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-9951774327887666"
     data-ad-slot="6606866336"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<script data-ad-client="ca-pub-9951774327887666" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
    <li>
      <h3>
        <a href="/github-usage-09-overall/">
          GitHub 사용법 - 09. Overall
          <small>27 May 2020</small>
        </a>
      </h3>
    </li>
    
    <li>
      <h3>
        <a href="/VAE/">
          Variational AutoEncoder 설명
          <small>25 May 2020</small>
        </a>
      </h3>
    </li>
    
    <li>
      <h3>
        <a href="/AFM/">
          추천 시스템의 기본 - 06. AFM 논문 리뷰 및 Tensorflow 구현
          <small>01 May 2020</small>
        </a>
      </h3>
    </li>
    
  </ul>
</div>

<div id="disqus_thread"></div>
<script>

  /**
   *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
   *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

  var disqus_config = function () {
    this.page.url = 'http://localhost:4000/RNN-Encoder-Decoder/';
    this.page.identifier = 'http://localhost:4000/RNN-Encoder-Decoder/';
    //this.page.url = 'https://greeksharifa.github.com/';  // Replace PAGE_URL with your page's canonical URL variable
    //this.page.identifier = 'greeksharifa'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };

  (function () { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://greeksharifa.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by
  Disqus.</a></noscript>

  </div>
</div>

<label for="sidebar-checkbox" class="sidebar-toggle"></label>

<script>
  (function (document) {
    let toggle = document.querySelector('.sidebar-toggle');
    let sidebar = document.querySelector('#sidebar');
    let checkbox = document.querySelector('#sidebar-checkbox');

    document.addEventListener('click', function (e) {
      let target = e.target;

      if (target === toggle) {
        checkbox.checked = !checkbox.checked;
        e.preventDefault();
      } else if (checkbox.checked && !sidebar.contains(target)) {
        /* click outside the sidebar when sidebar is open */
        checkbox.checked = false;
      }
    }, false);
  })(document);
</script>

<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    };
    i[r].l = 1 * new Date();
    a = s.createElement(o);
    m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

  ga('create', 'UA-00000000-1', 'auto');
  ga('send', 'pageview');
</script>


<!-- Naver Analytics -->	
<script type="text/javascript" src="//wcs.naver.net/wcslog.js"></script>
<script type="text/javascript">
  if(!wcs_add) var wcs_add = {};
    wcs_add["wa"] = "18cbce78e94161";
  wcs_do();
</script>

</body>

<script id="dsq-count-scr" src="//greeksharifa-github-io.disqus.com/count.js" async></script>

</html>
