<!DOCTYPE html>
<html lang="en-us">
<head>
  <head>
  <!-- Description of Blog -->
  <meta name="description" content="Python, Machine & Deep Learning">
  <link rel="canonical" href="https://greeksharifa.github.io/">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Python, Machine & Deep Learning">
  <meta property="og:description" content="Python, Machine Learning & Deep Learning 설명서">
  <meta property="og:image" content="https://greeksharifa.github.io/public/img/icon-144x144.png">
  <meta property="og:url" content="https://greeksharifa.github.io/">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Python, Machine & Deep Learning">
  <meta name="twitter:description" content="Python, Machine Learning & Deep Learning 설명서">
  <meta name="twitter:image" content="https://greeksharifa.github.io/public/img/icon-144x144.png">
  <meta name="twitter:domain" content="https://greeksharifa.github.io/">

  <!-- link -->
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/main.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="icon-144x144" sizes="144x144" href="/public/img/icon-144x144.png">
  <link rel="shortcut icon" href="/public/img/icon_32x32.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  
  <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_SVG"> </script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } });
  </script>
  

  <!-- Ads -->
  <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
  </script>
</head>

  <!-- for Google AdSense-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-9951774327887666",
    enable_page_level_ads: true
  });
</script>

  <style>blockquote {
    font-size: 1em;
    line-height: 1.4
  }</style>
  <link href='http://fonts.googleapis.com/css?family=Gill+Sans' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Consolas' rel='stylesheet' type='text/css'>
</head>
<body>

<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <div class="sidebar-personal-info">
      <div class="sidebar-personal-info-section">
        <a href="http://gravatar.com/3c2986ad7ac1f2230ea3596f44563328">
          <img src="/public/img/maple_tree.jpg" title="Cover Photo" alt="Maple tree" />
        </a>
      </div>
      <div class="sidebar-personal-info-section">
        <p><strong>Developer and Analyst</strong>, YW & YY.</p>
      </div>
      
      
      
      <div class="sidebar-personal-info-section">
        <p> Follow me:
        
        
        
        <a href="https://github.com/greeksharifa">
          <i class="fa fa-github" aria-hidden="true"></i>
        </a>
        
        |
        
        
        
        <a href="mailto:greeksharifa@gmail.com">
          <i class="fa fa-envelope" aria-hidden="true"></i>
        </a>
        
        
        
        </p>
      </div>
      
    </div>
  </div>

  <nav class="sidebar-nav">
    
      
      
      

      

      <span class="">
        <a class="sidebar-nav-item " href="/">
          Home
        </a>

        
      </span>

    
      
      
      

      

      <span class="foldable">
        <a class="sidebar-nav-item " href="/blog/">
          Blog
        </a>

        
          
            
            
            
              <a class="sidebar-nav-item sidebar-nav-item-sub " href="/blog/categories/">
                Categories
              </a>
          
        
          
            
            
            
              <a class="sidebar-nav-item sidebar-nav-item-sub " href="/blog/tags/">
                Tags
              </a>
          
        
      </span>

    
      
      
      

      

      <span class="">
        <a class="sidebar-nav-item " href="/about/">
          About
        </a>

        
      </span>

    
      
      
      

      

      <span class="">
        <a class="sidebar-nav-item " href="http://greeksharifa.github.io/">
          Github Project
        </a>

        
      </span>

    

  </nav>

  <div class="sidebar-item">
    <p>
    &copy; 2020 YW & YY. This work is liscensed under <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a>.
    </p>
  </div>

  <div class="sidebar-item">
    <p>
    Powered by <a href="http://jekyllrb.com">jekyll</a> and <a href="http://greeksharifa.github.io">YW & YY</a>
    </p>
  </div>
</div>


<!-- Wrap is the content to shift when toggling the sidebar. We wrap the
     content to avoid any CSS collisions with our real content. -->
<div class="wrap">
  <div class="masthead">
    <div class="container">
      <h3 class="masthead-title" align="center">
        <a href="/" title="Home" title="YW & YY">
          <img class="masthead-logo" src="/public/img/logo.png"/>
        </a>
        <small>YW & YY's Python, Machine & Deep Learning</small>
        <!-- HTML elements for search -->
        <a href="/search/" id="search_icon">
          <img src="/public/img/search.png" width="25" height="25"
               align="right" style="margin-top:5px; margin-bottom:0;"
               onmouseover="this.style.opacity=0.7" onmouseout="this.style.opacity=0.5"
               alt="search">
        </a>
      </h3>
    </div>
  </div>

  <div class="container content">
    <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/DDQN/">
        DDQN 알고리즘 설명
      </a>
    </h1>

    <span class="post-date">15 Mar 2020</span>
     |
    
    <a href="/blog/tags/#강화학습" class="post-tag">강화학습</a>
    
    <a href="/blog/tags/#파이썬" class="post-tag">파이썬</a>
    
    

    <article>
      <h2 id="1-ddqn-논문-리뷰">1. DDQN 논문 리뷰</h2>
<p>Deep Reinforcement Learning with Double Q-learning
<a href="https://arxiv.org/abs/1509.06461">논문 원본 링크</a></p>

<h3 id="11-abstract">1.1. Abstract</h3>
<p>Q-learning 알고리즘은 특정 조건 하에서 Action Value를 과대평가한다고 알려져있다. 본 논문에서는 먼저 DQN 알고리즘이 일부 게임 상황에서 중대한 과적합문제를 겪고 있다는 것을 밝힐 것이다. 이후 Double Q-learning이 large-scale function approximation에 적용될 수 있다는 것을 보여줄 것이다. 또한 이를 DQN에 적용하면, 과적합 문제를 해결할 수 있을 뿐만 아니라 몇몇 경우에 더 나은 퍼포먼스를 보여준다는 것을 보여줄 것이다.</p>

<p>강화학습의 중요한 목표는 누적된 Future Reward Signal을 최적화하여 Sequential Decision Problems에 적합한 Policy를 학습하는 것이다. Q-learning은 이 문제에 적합한 알고리즘이지만, 추정된 Action Value 값에 대해 max step을 취함으로써 비정상적으로 높은 Action Value를 학습하여 과적합 문제를 야기한다.</p>

<p>Overestimation이 Uniform한 분포를 띤다면 큰 문제가 되지 않겠지만, 일반적으로 Uniform하지 않으며 이는 알고리즘의 성능을 저해하는 요인이 된다. 본 논문에서는 <strong>Doulble DQN</strong>이 이 문제를 해결하여 더욱 정확한 추정값을 반환하고 더 나은 성능을 보인다는 것을 증명하고자 한다.</p>

<h3 id="12-background">1.2. Background</h3>
<p>Q함수는 state s에서 policy $\pi$에 따른 action a의 True Value로 정의된다.</p>

<script type="math/tex; mode=display">Q_{\pi}(s, a) = E[R_1 + {\gamma}R_2 + ... | S_0 = s, A_0 = a, {\pi}]</script>

<p>이 Q함수의 최적값은 아래와 같이 표현된다.</p>

<script type="math/tex; mode=display">Q^*(s, a) = \max_{\pi} Q_{\pi}(s, a)</script>

<p>이 최적 Policy는 각 state에서 가장 높은 값을 가지는 Action을 선택하여 derive할 수 있다. 수많은 state와 action 사이의 Q-value를 모두 학습하는 것은 불가능에 가깝기 때문에 우리는 <strong>Parameterized($\theta$) Value Function</strong>을 학습할 것이다. 표준 Q-learning의 업데이트 방식과 Target Y(True Value)는 아래와 같이 정의된다.</p>

<script type="math/tex; mode=display">\theta_{t+1} = \theta_t + \alpha(TargetY - Q(S_t, A_t ; \theta_t)) \nabla_{\theta_t} Q(S_t, A_t ; \theta_t)</script>

<script type="math/tex; mode=display">Target Y = Y^Q_t := R_{t+1} + \gamma \max_a Q(S_{t+1}, a; \theta_t)</script>

<p>위 업데이트 과정은 Target Value $Y^Q_T$를 향해 현재의 추정값 $Q(S_t, A_t ; \Theta_t)$를 업데이트하게 되는데, 이는 Stocastic Gradient Descent와 닮아 있다.</p>

<h4 id="deep-q-networks">Deep Q Networks</h4>
<p>본 네트워크는 state space에서 action space로 연결하는 Mapping Function에 해당한다. 타겟 네트워크와 경험 리플레이라는 2가지 방식을 통해 효과적인 학습을 수행한다.</p>

<h4 id="double-q-learning">Double Q-learning</h4>
<p>Q-learning과 DQN의 <strong>Max Operator</strong>는 action을 선택하고 평가할 때 동일한 값을 사용한다. 이는 과적합을 유발하게 된다. 이를 해결하기 위해 선택과 과정을 분리할 수 있는데, 이것이 Double Q-learning의 기본적인 아이디어이다.</p>

<p>초기의 Double Q-learning 알고리즘에서는 2개의 Value Function(Weight Sets: $\theta$ , $\theta$`)은 둘 중 하나만 업데이트하기 위해 각 experience를 랜덤하게 할당하는 방식으로 학습되었다. 각 업데이트에서 한 개의 Weight Set는 Greedy Policy를 결정하기 위해 사용되고 나머지 하나는 그 값을 결정하기 위해 사용되었다. 선택/평가를 분리하여 표현한 Target Y는 아래와 같다.</p>

<script type="math/tex; mode=display">Y^Q_t = R_{t+1} + \gamma \max_a Q(S_{t+1}, \argmax_a Q(S_{t+1}, a ; \theta_t); \theta_t)</script>

<p>Double Q-learning Error는 아래와 같다.</p>

<script type="math/tex; mode=display">Y^{DoubleQ}_t = R_{t+1} + \gamma \max_a Q(S_{t+1}, \argmax_a Q(S_{t+1}, a ; \theta_t); \theta_t^`)</script>

<p>action을 선택하는 부분(argmax 부분) 에서는 여전히 online weight인 $\theta_t$에 근거한다. 이는 여전히 $\theta_t$에 의해 정의된 현재 값들에 의해 Greedy Policy의 값을 추정한다는 뜻이다.</p>

<p>그러나 우리는 2번째 weight set인 $\theta_t^<code class="highlighter-rouge">$를 이용하여 Policy를 평가한다. 이 2번째 set에 대해서는 $\theta$와 $\theta</code>$의 역할을 바꿔가면서 대칭적으로 업데이트가 진행된다.</p>

<h3 id="13-overoptimism-due-to-estimation-errors">1.3. Overoptimism due to estimation errors</h3>
<p>Q-learning의 Overestimation은 처음으로 Thrun과 Schwartz에 의해 연구되었는데, 그들은 action value가 [$-\epsilon$, $\epsilon$] 사이의 Uniform Distribution을 갖는 random error를 포함하면, 각 Target은 최대 $ \frac{m-1}{m+1} $ 까지 Overestimate된다고 밝혔다. (m=num of actions) 또한 이들은 이러한 overestimation이 <strong>sub-optimal policy</strong>로 인도할 수 있다고 하였다.</p>

<p>이후 2010년에 Hasselt가 environment의 noise가 overestimation을 일으킬 수 있다고 하였고, Double Q-learning을 해결책으로 내놓았다.</p>

<p>본 섹션에서는 우리는 어떠한 종류의 estimation error든(이 error가 environmental noise에서 온 것이든, function approximation에서 온 것이든…) upward bias를 야기할 수 있다는 것을 증명하고자 한다. 이것은 굉장히 중요한 데, 왜냐하면 실제로 이 문제는 어떠한 방식으로든 학습과정에 있어 정확도를 낮출 것이기 때문이다.</p>

<p>Thrun과 Schwartz는 Overestimation의 Upper/Lower Bound를 구하는 방법을 제시했다. (논문 참조) 본 방법에서 우리는 다른 action에 대한 estimatino error가 독립적이라는 가정을 할 필요는 없다. 이 이론은 value에 대한 추정이 평균적으로 맞다하더라도, 어떤 source로 부터 온 estimation error라도 추정치를 끌어올려 True Optimal Value로 부터 멀어지게 만들 수 있다는 것을 보여준다.</p>

<center><img src="/public/img/RL/2020-03-15-DDQN/01.JPG" width="100%" /></center>

<p>위 그림을 보면 action의 수가 증가할 수록 Q-learning(빨간색)의 Overestimation은 증가하지만, Double Q-learning(파란색)은 Unbiased함을 알 수 있다.</p>

<p>이제 Function Approximation으로 돌아와서 각 state 마다 10개의 이산적인 action을 행할 수 있는 연속적인 state space를 생각해보자. 간단히 말해서 이 예시에서 True Optimal action value는 오직 state에만 의존하기 때문에 각 state마다 모든 action은 같은 True Value를 갖게 된다.</p>

<center><img src="/public/img/RL/2020-03-15-DDQN/02.JPG" width="100%" /></center>

<p>위 그림을 보면, <strong>보라색 그래프</strong>가 위에서 말한 <strong>True Value</strong>를 나타내며 $Q_<em>(s, a) = sin(s) $(가장 위), $Q_</em>(s, a) = 2exp(-s^2)$(중간, 밑)과 같이 정의된다.</p>

<p><strong>초록색 그래프</strong>는 <strong>State에 대한 함수로서의 single action의 근사값</strong>을 보여준다. 초록색 점으로 된 부분은 추정값이 기반이 되는 sample 값을 의미한다. 추정값은 sample state에서의 true value에 적합한 다항식으로 이루어지는데, 가장 아래 그래프는 9차, 나머지는 6차 방정식으로 구성된다. 각 sample state에서는 추정값이 정확히 True Value와 일치하기 때문에 이러한 sample state에서는 우리는 Ground Truth for action value를 갖고 있다고 판단한다.</p>

<p>상대적으로 차수가 낮은 위와 중간 그래프를 보면 그래프가 충분히 유연하지 못하여 sampled state에서도 부정확한 것을 알 수 있고, 차수가 높은 가장 아래의 그래프는 sampled state에서는 정확도가 높지만 unsampled state에서는 오히려 부정확한 것을 알 수 있다.</p>

<p>또한 sampled state들이 본 그래프에서는 더욱 서로 거리를 두고 있는 것을 확인할 수 있는데, 이러한 특성이 더욱 큰 Estimation Error를 발생시키게 되었다. 이렇게 특정 순간에 제한적인 데이터를 보유하게 되는 것은 실제 학습 상황에서 자주 발생하게 된다.</p>

<p>Example을 살펴보면, Overestimation은 심지어 우리가 특정 state의 true action value에 대한 sample을 갖고 있더라도 발생할 수 있다. 비록 Uniformly Overestimating Value는 Policy의 학습을 방해하지는 않겠지만 실제로 Overesimation Error는 여러 state와 action에 따라 다르다.</p>

<h3 id="16-double-dqn">1.6. Double DQN</h3>

<hr />

<h2 id="reference">Reference</h2>
<blockquote>

</blockquote>

    </article>
    <div class="post-more">
      
      <a href="/DDQN/#disqus_thread"> <i class="fa fa-comments" aria-hidden="true"></i>Comment</a>&nbsp;
      
      <a href="/DDQN/"><i class="fa fa-plus-circle" aria-hidden="true"></i>Read more</a>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/Explain-Yourself-Leveraging-Language-Models-for-Commonsense-Reasoning/">
        Explain Yourself! Leveraging Language Models for Commonsense Reasoning
      </a>
    </h1>

    <span class="post-date">08 Feb 2020</span>
     |
    
    <a href="/blog/tags/#paper-review" class="post-tag">Paper_Review</a>
    
    <a href="/blog/tags/#nlp" class="post-tag">NLP</a>
    
    

    <article>
      <hr />

<p>이 글에서는 2019년 6월 <em>Nazneen Fatema Fajani</em> 등이 발표한 <strong>Explain Yourself! Leveraging Language Models for Commonsense Reasoning</strong> 논문을 살펴보도록 한다.</p>

<p>이 논문에서는 <strong>CoS-E</strong>라는 상식 설명문(Common Sense Explanations)에 관한 데이터셋을 만들어 공개했다. <a href="https://github.com/salesforce/cos-e">여기</a>에서 찾아볼 수 있다(논문의 링크로 들어가보면 저장 위치가 바뀌었다고 한다).</p>

<p>중요한 부분만 적을 예정이므로 전체가 궁금하면 원 논문을 찾아 읽어보면 된다.</p>

<hr />

<h1 id="explain-yourself-leveraging-language-models-for-commonsense-reasoning">Explain Yourself! Leveraging Language Models for Commonsense Reasoning</h1>

<p>논문 링크: <strong><a href="https://arxiv.org/abs/1906.02361">Explain Yourself! Leveraging Language Models for Commonsense Reasoning</a></strong></p>

<p>Dataset: <strong><a href="https://github.com/salesforce/cos-e">CoS-E</a></strong></p>

<h2 id="초록abstract">초록(Abstract)</h2>

<p>딥러닝 모델들은 상식추론(Commonsense Reasoning)이 필요한 task에서는 낮은 성능을 보여, 입력에는 당장 나타나지 않는 어떤 정보에 대한 지식이나 추론이 필요하게 하였다. 우리(이 논문의 저자)는 <strong>CoS-E(Common Sense Explanations)</strong>라 부르는, 1) 일련의 자연어와 2) 강조된 구문 두 가지 형태로 구성된 새로운 데이터셋을 수집했다. <strong>CAGE(Commonsense Auto-Generated Explanation)</strong> Framework에서 학습 및 추론 단계에서 사용될 수 있는 설명문(explanations)을 자동으로 생성하도록 언어모델을 학습시켰다. CAGE는 상식질답(CommonsenseQA) task에서 10%만큼 State-of-the-art를 뛰어넘었다. 우리는 또한 out-of-domain으로의 전이학습을 포함하여 사람이 그리고 기계가 자동생성한 설명문을 전부 사용하여 DNN에서 상식추론 문제를 연구할 것이라 하였다. 실험결과는 상식추론에 관해 언어모델을 효과적으로 조정(Leverage)할 수 있음을 시사한다.</p>

<hr />

<h2 id="1-서론introduction">1. 서론(Introduction)</h2>

<p>상식추론(Commonsense Reasoning)은 현대 기계학습 방법에서 도전적인 과제이다. 설명문(Explanations)은 모델이 학습하는 추론을 말로 표현하는 방법이다. 상식질답(Commonsense QA, CQA)는 상식추론 능력을 가진 자연어처리(NLP) 모델을 개발하기 위한 다지선다형 질답 데이터셋이다. 이와 관련해 많은 노력이 있었지만 뚜렷한 발전이 없었다.<br />
이 논문의 저자들은 CQA에 더해 상식추론을 위한 사람의 설명문을 수집했고 이를 <strong>CoS-E</strong>라 하였다. CoS-E는</p>

<ol>
  <li>자유형식의 일련의 자연어(보통 문장)</li>
  <li>정답을 추론하는 데 중요하다고 사람이 판단한 문장의 일부를 강조한 부분</li>
</ol>

<p>두 가지 형태로 존재한다. 아래 그림에서 Question과 Choicse(3개)는 CQA dataset의 일부이며, CoS-E는 1) CoS-E 부분의 문장과 2) Question에서 노란색으로 강조된 부분을 포함한다.</p>

<center><img src="/public/img/2020-02-08-Explain Yourself - Leveraging Language Models for Commonsense Reasoning/01.png" width="80%" alt="Examples" /></center>

<p><a href="https://www.aclweb.org/anthology/N19-1421/">Talmor et al. (2019)</a>에서는 Google search를 활용하여 각 질답 당 100개의 snippet으로부터 문맥정보를 추출해내는 것은 ELMo 표현에 self-attention layer를 쓴 모델이자 현재 SOTA(state-of-the-art) 모델인 BiDAF++를 사용해도 CQA에서 정답률을 향상시키지 못한다고 하였다.</p>

<p>이에 반해, 우리는 상식추론에 유용한 설명문(explanations)을 생성하는 사전학습된 모델을 조정하였다. CQA를 위한 설명문을 생성하는 framework로 <strong>CAGE(Commonsense Auto-Generated Explanations)</strong>를 제안한다. 우리는 상식추론 문제를 두 단계로 나누었다:</p>

<ol>
  <li>CQA sample과 그에 맞는 CoS-E 설명문을 언어모델에 입력으로 준다. 언어모델은 CQA 질답에 기초하여 CoS-E 설명문을 생성하도록 학습된다.</li>
  <li>언어모델은 CQA의 학습(training)과 검증(validation) 세트 안에 있는 각 sample에 대해 설명문을 생성하도록 한다. 이 CAGE 설명문은 원래의 질문, 선택지, 언어모델의 출력값에 이어붙여 두 번째 상식추론 모델의 입력으로 들어간다.</li>
</ol>

<p>이 2단계의 CAGE framework는 기존 최고의 baseline보다 10% 초과 달성한 결과를 얻었으며 그 예측값을 정당화(justify)하는 설명문을 생성하였다. 아래 그림은 이 접근법을 개략적으로 보여준다.</p>

<center><img src="/public/img/2020-02-08-Explain Yourself - Leveraging Language Models for Commonsense Reasoning/02.png" width="100%" alt="Examples" /></center>

<p>요약하면, 이 논문은 상식추론을 위한 새로운 CoS-E 데이터셋을 소개하였고, CQA v1.0에서 65%의 정답률을 보인 ‘설명문을 자동 생성하는’ CAGE framework를 제안하였다.</p>

<p>참고로, 이 논문이 제출되기 직전 CQA는 v1.11를 공개하였는데, 질문에 대한 선택지가 3개에서 5개로 늘어났다. 더 도전적인(challenging) 과제로 바뀌었다.</p>

<hr />

<h2 id="2-배경이론과-관련-연구background-and-related-work">2. 배경이론과 관련 연구(Background and Related Work)</h2>

<p>논문에 2.1. section이라 소개하진 않았지만 목차를 위해 넣었다.</p>

<h3 id="21-commonsense-reasoning">2.1. Commonsense Reasoning</h3>

<p>자연어에 포함된 상황이나 사건의 관계를 예측하도록 요구하는 데이터셋이 최근 몇 개가 소개되어 왔다.</p>

<ul>
  <li>여러 타당한 결말 중 가장 올바른 스토리 결말을 선택하는 Story Cloze(혹은 ROC Stories)</li>
  <li>초기 상황에 기초하여 다음 장면을 예측하는 SWAG(Situations with Adversarial Generations)</li>
</ul>

<p>이러한 데이터셋에 대해서는 <a href="https://greeksharifa.github.io/nlp(natural%20language%20processing)%20/%20rnns/2019/08/21/OpenAI-GPT-1-Improving-Language-Understanding-by-Generative-Pre-Training/">GPT</a>나 <a href="https://greeksharifa.github.io/nlp(natural%20language%20processing)%20/%20rnns/2019/08/23/BERT-Pre-training-of-Deep-Bidirectional-Transformers-for-Language-Understanding/">BERT</a>이 이미 사람 수준의 성능을 내지만, 대명사가 어떻게 다른 부분과 연관이 되어 있으며 어떻게 세상의 지식과 상호작용을 하는지 등에 관해서는 별로 성공적이지 못했다.</p>

<p><a href="https://www.aclweb.org/anthology/N19-1421.pdf">CQA</a>는 9500개의, 질문 + 1개의 정답 + 2개의 헷갈리는 오답으로 구성되어 있는 데이터셋으로 단지 분포상의 편향(biases)에서 정보를 얻기보다는 질문에서 추론하도록 하는 것을 요구하지만, 언어적인 면에서 좋지 않은 쪽으로 편향되어 있음이 발견되었다. 이를테면, 여자와 관련된 부분에서는 부정적인 의미의 문맥이 있다거나 하는.</p>

<p>SOTA 언어모델은 사람에 비해 CQA 데이터셋에서 굉장히 낮은 성능을 보인다. CQA는 모델의 상식추론 능력을 측정하는 benchmark를 제공함에도 정확히 어떤 부분이 모델이 추론을 행하는지는 여전히 불확실하다. CoS-E는 이 benchmark에 더해, 다른 한편으로 모델의 추론능력을 연구, 평가 및 분석할 수 있도록 하는 설명문을 제공한다.</p>

<h3 id="22-natural-language-explanations">2.2. Natural language explanations</h3>

<p><a href="https://people.csail.mit.edu/taolei/papers/emnlp16_rationale.pdf">Lei et al.</a>에서는 감정분석 접근법의 타당성을 입증할 수 있는, 어떤 추론 결과를 내기 위해 필요한 구문을 입력에서 강조(선택)하는 방식을 제안했다. 분류데이터를 위한 사람이 만든 자연어 설명문은 의미분석을 학습하기 위해 사용되어왔고 분류기를 학습시키는 데 사용할 수 있는, noisy한 분류 데이터를 생성하였다. 그러나 전이성(interpretability)은 SNLI(Stanford Natural Language Inference)에서 성능저하를 보인다고 한다.<br />
그러나, e-SNLI와는 다르게, CQA를 위한 설명문은 설명-예측 단계로 성능을 향상시킬 수 있다. 또한 VQA에도 사용 가능하며, 자동생성된 것과 사람이 만든 설명문을 함께 사용하는 것이 따로 사용하는 것보다 더 좋은 결과를 내었다.</p>

<h3 id="23-knowledge-transfer-in-nlp">2.3. Knowledge Transfer in NLP</h3>

<p>자연어처리는 Word2Vec이나 GloVe와 같은 사전학습된 단어벡터를 통한 지식의 이전(transfer)에 의존한다. 맥락과 관련된(contextualized) 단어벡터의 사용은 여러 task에서 획기적인 성공을 이뤘다. 이러한 모델들은 적은 수의 parameter만 학습시킬 필요가 있고 따라서 적은 데이터만 갖고 있어도 학습이 가능하다는 장점이 있다. 잘 fine-tuned 된 언어모델은 설명문 생성과 함께 조정될 때 더 효과적이며 언어적으로 상식 정보를 얻어낸다는 점도 실험적으로 증명되었다.</p>

<hr />

<h2 id="3-common-sense-explanationscos-e">3. Common Sense Explanations(CoS-E)</h2>

<p>이 CoS-E 데이터셋은 아마존의 MTurk(Amazon Mechanical Turk)를 통해 수집되었다. CQA 데이터셋은 <em>question token split</em> 과 <em>random split</em> 두 개로 이루어져 있다. CoS-E 데이터셋과 이 논문의 모든 실험은 더 어려운 <em>random split</em> 을 사용하여 진행되었다. CQA v1.11에 대한 CoS-E도 만들었다.</p>

<p>사람들은 질문, 선택지, 정답이 주어지면 “왜 이것이 가장 적절한 답으로 예측되었는가?”라는 질문을 받는다. 그리고</p>

<ul>
  <li>주어진 정답이 왜 정답일지를 알려줄 수 있는 부분을 질문에서 선택하며,</li>
  <li>또한 이 질문 뒤에 숨어 있을 상식적인 내용을 설명하는 자연어 문구를 작성하도록</li>
</ul>

<p>지시받았다. (참고: 이는 CoS-E 데이터셋의 설명과 일치함.)</p>

<p>그래서 CQA v1.0에 대해 7610(train random split) + 950(dev random split)개의 설명문을, v1.11에 대해 9741 + 1221개의 설명문을 수집하였다. 또한 여기서부터는 질문에서 선택된 부분을 <strong><em>CoS-E-selected</em></strong>, 작성한 자연어 문구(open-ended)는 <strong><em>CoS-E-open-ended</em></strong> 라 한다.</p>

<p>MTurk에서는 사람들의 답변의 품질이 좋다는 것을 보장할 수 없기 때문에, 다음과 같은 처리를 거쳤다:</p>

<ul>
  <li>질문에서 아무 것도 선택하지 않거나</li>
  <li>작성한 설명문이 4단어 이하이면 답변하지 않은 것으로 처리되며</li>
  <li>‘이 정답은 답이 되는 유일한 것이다’와 같은 답변은 모두 제거하였다.</li>
</ul>

<center><img src="/public/img/2020-02-08-Explain Yourself - Leveraging Language Models for Commonsense Reasoning/03.png" width="80%" alt="Examples" /></center>

<p>위 그림은 CoS-E v1.0 데이터셋의 분포를 보여준다.<br />
이 논문의 실험에서는 CoS-E를 오직 학습(training) 과정에만 사용하여 SOTA 결과를 얻었으며, CoS-E 데이터셋을 사용한 경우가 그렇지 않은 경우보다 성능이 더 좋다는 것을 실험적으로 보였다.</p>

<p>CoS-E는 crowd-sourcing으로 얻어진 것이기 때문에 noisy할 수는 있지만 그만큼 다양성이 확보되었으며 충분한 품질을 갖고 있는 것으로 보인다고 한다.</p>

<hr />

<h2 id="4-알고리즘algorithm">4. 알고리즘(Algorithm)</h2>

<p>CAGE(Commonsense Auto-Generated Explanations)를 제안하고 이를 CQA task에 적용한다. CAGE는 언어모델에 의해 생성되었으며 분류모델의 보조 입력으로 사용된다. CQA 데이터셋의 각 샘플은 질문 $q$, 선택지 $c0, c1, c2$, 정답 레이블 $a$로 구성된다. CoS-E 데이터셋은 왜 $a$가 가장 적절한지를 말해주는, 사람이 만든 설명문 $e_h$가 추가된다. CAGE의 출력은 생성한 설명문 $e$가 $e_h$에 가까워지도록 학습하는 언어모델이다.</p>

<h3 id="41-commonsense-auto-generated-explanationscage">4.1. Commonsense Auto-Generated Explanations(CAGE)</h3>

<p>CAGE를 분류모델에 적용하기 위해, 언어모델(LM)을 CoS-E 데이터셋으로부터 설명문을 생성하도록 fine-tune했다. 이 언어모델은 여러 <a href="https://greeksharifa.github.io/nlp(natural%20language%20processing)%20/%20rnns/2019/08/17/Attention-Is-All-You-Need/">transformer</a> 레이어로 이루어진, 사전학습된 <a href="https://greeksharifa.github.io/nlp(natural%20language%20processing)%20/%20rnns/2019/08/21/OpenAI-GPT-1-Improving-Language-Understanding-by-Generative-Pre-Training/">OpenAI GPT</a>이다.<br />
여기서, 설명문 생성과 관련하여 두 가지 설정:</p>

<ol>
  <li>설명 후 예측(explain-and-then-predict(reasoning))</li>
  <li>예측 후 설명(predict-and-then-explain(rationalization))</li>
</ol>

<p>으로 진행하였다.</p>

<h4 id="reasoning">Reasoning</h4>

<p>이 방법이 이 논문의 주된 접근법이다. 언어모델은 질문, 선택지, 사람의 설명문으로 fine-tuned 되었으며 실제 정답 label로는 학습되지 않았다. 그래서, 학습하는 동안 입력 문맥(context)은 다음과 같이 정의된다:</p>

<p>$ C_{RE} = “q, c0, c1 \ or\  c2? $ commonsense says</p>

<p>모델은 조건부 언어모델링 목적함수에 따라 설명문 $e$를 생성한다:</p>

<script type="math/tex; mode=display">\sum_i  log P (e_i \vert e_{i-k}, ..., e_{i-1}, C_{RE} ; \Theta )</script>

<p>$k$는 문맥범위(context window)의 크기(이 논문에서는 항상 $ k \ge \vert e \vert $로 전체 설명문이 문맥에 포함됨)이다.<br />
이 방식은 상식 질답 문제의 추론 단계에서 추가 문맥정보를 전달하기 위해 설명문을 자동생성하므로 <em>reasoning</em> 이라 부르기로 하였다.</p>

<p>또한 실험의 완전성을 위해, 추론과 설명의 단계를 바꿔보았는데, 그것이 다음에 설명할 <strong>rationalization</strong>이다.</p>

<h4 id="rationalization">Rationalization</h4>

<p>언어모델은 post-hoc rationalization을 생성하기 위해 입력과 더불어 예측된 label을 조건으로 한다. 그래서 fine-tuning 단계에서 입력 문맥은 다음과 같다.</p>

<p>$ C_{RE} = “q, c0, c1 \ or\  c2?\  a$ because</p>

<p>목적함수는 reasoning의 것과 유사하지만 모델은 학습 중에도 입력 질문에 대한 실제 정답을 볼 수 있다. 언어모델은 예측 label에 조건을 갖기 때문에 설명문은 상식추론으로 고려될 수 없다. 대신 설명문은 모델이 더 이해 및 해석하기 쉽도록 만드는 <em>rationalization</em> 을 제공한다. 이 접근법은 현 최고의 모델보다 6% 더 높은 성능을 가지며 품질 좋은 설명문을 생성해 낸다.</p>

<p>CAGE에 대해서, 최대길이 20, batch size 36, 10 epoch 동안 학습시겨 가장 좋은 BLEU 점수와 perplexit를 갖는 모델은 선택했다. 학습률(learning rate)는 $1e^{-6}$, 초반 0.002까지 선형적으로 증가하다가(warm-up lr) 0.01만큼 decay되는 방식을 채택했다.</p>

<h3 id="42-commonsense-predictions-with-explanations">4.2. Commonsense Predictions with Explanations</h3>

<p>CoS-E의 사람의 설명문이나 언어모델의 추론 중 하나를 갖고 있을 때 CQA task에 대한 예측모델을 학습시킬 수 있다. 모든 BERT 모델의 입력 샘플의 시작 부분에 들어가는 <code class="highlighter-rouge">[CLS]</code> token에 해당하는 최종 상태(final state)를 입력으로 받는 이진 분류기를 추가함으로써 다지선다형 질문 task에 fine-tuning 될 수 있는 <a href="https://greeksharifa.github.io/nlp(natural%20language%20processing)%20/%20rnns/2019/08/23/BERT-Pre-training-of-Deep-Bidirectional-Transformers-for-Language-Understanding/">BERT</a>를 분류기로 사용하였다. 이를 CQA task에도 적용했는데,</p>

<ul>
  <li>데이터셋의 각 샘플에 대해
    <ul>
      <li>BERT를 fine-tuning하기 위한 일련의 세 입력을 구성하고</li>
      <li>각 입력은 (질문, 구분자 <code class="highlighter-rouge">[SEP]</code>, 선택지 중 하나)로 구성된다.</li>
    </ul>
  </li>
  <li>만약 CoS-E나 CAGE의 설명문을 추가한다면
    <ul>
      <li>각 입력은 (질문, 구분자 <code class="highlighter-rouge">[SEP]</code>, 설명문, 구분자 <code class="highlighter-rouge">[SEP]</code>, 선택지 중 하나)로 이루어진다.</li>
    </ul>
  </li>
</ul>

<p>BERT를 위해 설명문은 한 질문에 대해 같은 입력표현을 공유한다. 선택지에 대해서도 공유하는 것은 약간의 성능저하를 보였다.</p>

<h3 id="43-transfer-to-out-of-domain-datasets">4.3. Transfer to out-of-domain datasets</h3>

<p>Out-of-domain NLP 데이터셋에 fine-tuning 없이 전이학습을 시키는 것은 낮은 성능을 기록한다고 알려져 있다.<br />
이 논문에서는 CQA에서 SWAG와 Story Cloze Test(둘 모두 CQA같은 다지선다형이다)에 대해서 전이학습을 연구했다. CQA에 fine-tuned된 GPT 언어모델을 SWAG에 대한 설명문을 생성하기 위해 사용하였다. 그리고 이를 통해 BERT 분류기를 학습시켜 두 데이터셋에 평가를 진행했다.</p>

<hr />

<h2 id="5-실험-결과experimental-results">5. 실험 결과(Experimental Results)</h2>

<p>모든 모델은 BERT에 기초하며, CoS-E나 CAGE를 쓰지 않을 것이 baseline이 되며, 모든 실험은 CQA dev-random-split에서 수행되었다. 또한 final test split에서도 핵심 모델을 평가하였다.</p>

<p>CoS-E 설명을 사용할수록 성능이 높아짐을 확인할 수 있다.</p>

<center><img src="/public/img/2020-02-08-Explain Yourself - Leveraging Language Models for Commonsense Reasoning/04.png" width="80%" alt="Examples" /></center>

<p>아직 사람에 비해서는 모든 모델이 한참 못 미치지만, CoS-E와 CAGE를 사용함으로써 성능이 좋아졌다.</p>

<center><img src="/public/img/2020-02-08-Explain Yourself - Leveraging Language Models for Commonsense Reasoning/05.png" width="80%" alt="Examples" /></center>

<p>위의 표의 마지막에 있는 89.8%이라는 수치는 설명문을 제공받은 사람은 실제 정답을 갖고 있었기 때문에 공정한 수치는 아니라고 하지만, CoS-E-open-ended를 사용했을 때 얼마만큼 성능을 향상시킬 수 있을지에 대한 상한선을 보여준 것이라 한다. 또한 질문이 없는 상태에서 진행한 실험도 있는데, 질문 없이 어떤 정답이 가장 정답일 것 같은지를 설명문을 보고 판단하는 실험이다.<br />
그리고 open-ended CoS-E의 경우 질문에 이미 있는 쓸모 있는 정보를 알려주는 것을 넘어 중요한 정보를 제공한다는 것을 보여준다.</p>

<center><img src="/public/img/2020-02-08-Explain Yourself - Leveraging Language Models for Commonsense Reasoning/06.png" width="60%" alt="Examples" /></center>

<p>CQA v1.11에 대한 실험도 진행하였고 그 결과는 위 그림에서 볼 수 있다.</p>

<p>전이학습에 대한 결과는 아래 그림에서 볼 수 있는데, CQA에서 SWAG와 Story Cloze로 전이된 설명문을 추가한 경우 약간의 성능저하가 있음을 보였다.</p>

<center><img src="/public/img/2020-02-08-Explain Yourself - Leveraging Language Models for Commonsense Reasoning/07.png" width="80%" alt="Examples" /></center>

<hr />

<h2 id="6-분석-및-토의analysis-and-discussion">6. 분석 및 토의(Analysis and Discussion)</h2>

<p>CAGE-reasoning은 72%의 성능을 보였는데, CoS-E-open-ended의 모든 정보를 활용한다면 최대 90% 정도까지 성능이 올라갈 수 있음을 보였기 때문에, 추가적인 분석이 더 필요하다.<br />
CAGE-reasoning과 CoS-E-open-ended 간 BLEU 점수는 4.1이며 perplexity는 32를 보였다.</p>

<p>아래 그림은 CQA, CoS-E, CAGE 샘플을 가져온 것인데, CAGE-reason이 일반적으로 CoS-E보다 조금 더 간단한 구성을 보이는데, 이 조금 더 선언적인 부분이 CoS-E-open-ended보다 더 유익한 경우가 있다(실제 단어 차이는 거의 없다). CAGE-reasoning은 43%의 경우에서 선택지 중 적어도 하나를 포함하는데, 모델의 실제 예측 선택지는 21%만이 그러하였다. 이는 답을 직접적으로 가리키는 것보다 더 효과적인 부분이 CAGE-reasoning에 있음을 보여준다.</p>

<center><img src="/public/img/2020-02-08-Explain Yourself - Leveraging Language Models for Commonsense Reasoning/08.png" width="100%" alt="Examples" /></center>

<p>CAGE-rationalization이 CAGE-reasoning보다 조금 더 나은 것 같기도 하지만, 실제 질문 없이 정답을 추측하는 부분에서는 별 향상이 없다.</p>

<p>CoS-E나 CAGE가 noisy하다고 해도, 모델의 성능이 낮은 것이 이것 때문이라 볼 수는 없다. 만약 CQA의 세 선택지 중 하나를 호도하는 선택지로 일부러 바꾼 경우 모델의 성능은 60%에서 30%로 떨어졌다. 에러의 70%는 호도하는 설명문에 의해 만들어졌고, 그 중 57%는 대신 CoS-E 설명문으로 학습된 모델에 의해 올바르게 정답을 맞췄다. 이는 유익한 설명문의 효과를 보여준다.</p>

<p>CQA v1.11에서는 BERT를 1.5% 차이로 앞섰는데, CQA v1.11에서 잘못 예측한 예시는 아래에서 볼 수 있다. 잘못 예측한 것 중 많은 부분은 생성된 설명문에 맞는 정답을 포함하는 경우가 있었다(dresser drawer과 cleanness 등). 이러한 경우는 관련 있는 정보에 더 집중하도록 하는 명시적인 방법이 필요로 함을 보여준다. 그리고 “forest”와 “compost pile” 같은 의미적으로 비슷한 다른 선택지를 고르는 경우도 빈번했는데, 이는 새로운 CQA 데이터셋에서 설명문을 단지 덧붙이는 것만으로는 충분하지 않음을 보여준다.</p>

<center><img src="/public/img/2020-02-08-Explain Yourself - Leveraging Language Models for Commonsense Reasoning/09.png" width="100%" alt="Examples" /></center>

<p>SWAG와 Story Cloze에 맞춰 생성한 설명문은 유익한 정보를 담고 있는 것을 발견했지만, 전이학습에 대한 실험에서 분류기가 이를 제대로 활용하지는 못했다.</p>

<center><img src="/public/img/2020-02-08-Explain Yourself - Leveraging Language Models for Commonsense Reasoning/10.png" width="100%" alt="Examples" /></center>

<hr />

<h2 id="7-결론-및-향후-연구conclusion-and-future-work">7. 결론 및 향후 연구(Conclusion and Future Work)</h2>

<p>CoS-E라는 새로운 데이터셋을 제시하였고, CAGE framework를 제안하였으며, 여기서 생성된 설명문(explanations)은 예측을 위해 분류기에서 효율적으로 사용될 수 있었다. 이로써 단지 SOTA를 달성한 것 뿐만 아니라, 이해할 수 있는(interpretable) 상식추론과 관련해 설명문을 연구하는 새로운 길을 열었다.</p>

<p>CAGE는 답을 예측하기 위한 사전 작업으로 설명문을 생성하는 데 집중했는데, 설명문을 통한 언어모델은 정답 예측에 있어 함께 학습될 수도 있다. 이는 더 많은 task에 적용될 수 있을 것이다. 많은 task에 대해 충분한 설명문 데이터셋(CoS-E)가 있으면 다른 task에 대해서도 유용한 설명문을 생성하는 언어모델을 만들 수도 있다.</p>

<p>그리고, 설명문은 편향이 없어야 할 것이다. 예를 들어 CQA에서는 ‘여성’과 ‘부정적인 문맥’의 연관도가 다른 쪽에 비해 더 높았는데, 이러한 편향이 있음은 모델 학습에 있어 분명 고려되어야 한다.</p>

<p><strong>Acknowledgements</strong></p>

<p>언제나 있는 감사의 인사. 그림과 reviewer 등등</p>

<hr />

<h2 id="refenrences">Refenrences</h2>

<p>논문 참조. 많은 레퍼런스가 있다.</p>

<hr />


    </article>
    <div class="post-more">
      
      <a href="/Explain-Yourself-Leveraging-Language-Models-for-Commonsense-Reasoning/#disqus_thread"> <i class="fa fa-comments" aria-hidden="true"></i>Comment</a>&nbsp;
      
      <a href="/Explain-Yourself-Leveraging-Language-Models-for-Commonsense-Reasoning/"><i class="fa fa-plus-circle" aria-hidden="true"></i>Read more</a>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/error/">
        파이썬 Error 처리
      </a>
    </h1>

    <span class="post-date">12 Jan 2020</span>
     |
    
    <a href="/blog/tags/#references" class="post-tag">References</a>
    
    <a href="/blog/tags/#파이썬" class="post-tag">파이썬</a>
    
    

    <article>
      <h2 id="1-introduction">1. Introduction</h2>
<p>파이썬에서 에러를 처리하고 관리하는 데에는 다양한 이유가 있다. 실제 Applicaion 상에서 에러가 발생하지 않도록 개발과 테스트 단계에서 미리 에러를 식별하고 수정하는 것은, 어떤 프로그램을 만들 때 굉장히 중요한 과정이라고 할 수 있다.</p>

<p>기본적으로 파이썬에서는 <code class="highlighter-rouge">BaseException</code>이라는 class를 통해 에러를 관리하도록 도와준다. 이 class는 모든 내장 exception들의 base class이다. 만약 사용자가 직접 에러 class를 만들고 싶을 때는 이 에러를 사용하는 것이 <strong>아니라</strong> <code class="highlighter-rouge">Exception</code> class를 사용해야 한다.</p>

<p>코딩을 하다보면 여러 종류의 에러를 보았을 것이다. 예를 들어 아래와 같은 에러가 대표적일 것이다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ValueError</span>
<span class="nb">AssertionError</span>
<span class="nb">FileNotFoundError</span>
<span class="nb">SyntaxError</span>
</code></pre></div></div>

<p>대체 이 에러들은 다 어떻게 만들어지고, 어떻게 구성되는 것일까? 사실 이 에러들은 앞서 설명한 <code class="highlighter-rouge">BaseException</code> class의 하위 class로 이루어진다. 그 전체 구조는 아래와 같다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">BaseException</span>
 <span class="o">+--</span> <span class="nb">SystemExit</span>
 <span class="o">+--</span> <span class="nb">KeyboardInterrupt</span>
 <span class="o">+--</span> <span class="nb">GeneratorExit</span>
 <span class="o">+--</span> <span class="nb">Exception</span>
      <span class="o">+--</span> <span class="nb">StopIteration</span>
      <span class="o">+--</span> <span class="nb">StopAsyncIteration</span>
      <span class="o">+--</span> <span class="nb">ArithmeticError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">FloatingPointError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">OverflowError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">ZeroDivisionError</span>
      <span class="o">+--</span> <span class="nb">AssertionError</span>
      <span class="o">+--</span> <span class="nb">AttributeError</span>
      <span class="o">+--</span> <span class="nb">BufferError</span>
      <span class="o">+--</span> <span class="nb">EOFError</span>
      <span class="o">+--</span> <span class="nb">ImportError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">ModuleNotFoundError</span>
      <span class="o">+--</span> <span class="nb">LookupError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">IndexError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">KeyError</span>
      <span class="o">+--</span> <span class="nb">MemoryError</span>
      <span class="o">+--</span> <span class="nb">NameError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">UnboundLocalError</span>
      <span class="o">+--</span> <span class="nb">OSError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">BlockingIOError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">ChildProcessError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">ConnectionError</span>
      <span class="o">|</span>    <span class="o">|</span>    <span class="o">+--</span> <span class="nb">BrokenPipeError</span>
      <span class="o">|</span>    <span class="o">|</span>    <span class="o">+--</span> <span class="nb">ConnectionAbortedError</span>
      <span class="o">|</span>    <span class="o">|</span>    <span class="o">+--</span> <span class="nb">ConnectionRefusedError</span>
      <span class="o">|</span>    <span class="o">|</span>    <span class="o">+--</span> <span class="nb">ConnectionResetError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">FileExistsError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">FileNotFoundError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">InterruptedError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">IsADirectoryError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">NotADirectoryError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="n">PermissionError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">ProcessLookupError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">TimeoutError</span>
      <span class="o">+--</span> <span class="nb">ReferenceError</span>
      <span class="o">+--</span> <span class="nb">RuntimeError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">NotImplementedError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">RecursionError</span>
      <span class="o">+--</span> <span class="nb">SyntaxError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">IndentationError</span>
      <span class="o">|</span>         <span class="o">+--</span> <span class="nb">TabError</span>
      <span class="o">+--</span> <span class="nb">SystemError</span>
      <span class="o">+--</span> <span class="nb">TypeError</span>
      <span class="o">+--</span> <span class="nb">ValueError</span>
      <span class="o">|</span>    <span class="o">+--</span> <span class="nb">UnicodeError</span>
      <span class="o">|</span>         <span class="o">+--</span> <span class="nb">UnicodeDecodeError</span>
      <span class="o">|</span>         <span class="o">+--</span> <span class="nb">UnicodeEncodeError</span>
      <span class="o">|</span>         <span class="o">+--</span> <span class="nb">UnicodeTranslateError</span>
      <span class="o">+--</span> <span class="nb">Warning</span>
           <span class="o">+--</span> <span class="nb">DeprecationWarning</span>
           <span class="o">+--</span> <span class="nb">PendingDeprecationWarning</span>
           <span class="o">+--</span> <span class="nb">RuntimeWarning</span>
           <span class="o">+--</span> <span class="nb">SyntaxWarning</span>
           <span class="o">+--</span> <span class="nb">UserWarning</span>
           <span class="o">+--</span> <span class="nb">FutureWarning</span>
           <span class="o">+--</span> <span class="nb">ImportWarning</span>
           <span class="o">+--</span> <span class="nb">UnicodeWarning</span>
           <span class="o">+--</span> <span class="nb">BytesWarning</span>
           <span class="o">+--</span> <span class="nb">ResourceWarning</span>
</code></pre></div></div>

<p>굉장히 많다. 이 에러와 경고(Warning)들을 다 외우고 있을 필요는 없을 것이다. 하지만 인지는 하고 있는 편이 좋다.</p>

<hr />

<h2 id="2-exception-처리-try-except-finally">2. Exception 처리: try, except, finally</h2>
<h3 id="21-일반적인-처리">2.1. 일반적인 처리</h3>
<p>try 블록을 수행하는 과정에서 에러가 발생하면 except 블록이 수행된다. 만약 에러가 발생하지 않았다면, except 블록은 수행되지 않는다. 만약 에러의 발생 유무와 상관없이 꼭 어떤 과정을 수행하고 싶다면 finally 블록에 이를 담으면 된다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 예시 1
</span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">nothing</span>
<span class="k">except</span> <span class="nb">ImportError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
    <span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>


<span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="s">'nothing'</span>
<span class="p">[</span><span class="mi">1</span> <span class="mi">2</span><span class="p">]</span>

<span class="c1"># 예시 2
</span><span class="k">try</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">0</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">ZeroDivisionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Error: You cannot divide integer by zero"</span><span class="p">)</span>

<span class="n">Error</span><span class="p">:</span> <span class="n">You</span> <span class="n">cannot</span> <span class="n">divide</span> <span class="n">integer</span> <span class="n">by</span> <span class="n">zero</span>
</code></pre></div></div>

<p>참고로 <code class="highlighter-rouge">assert 조건, "에러 메시지"</code> 인 <strong>assert 구문</strong>을 통해 에러를 관리할 수도 있다.</p>

<h3 id="22-특별한-요청">2.2. 특별한 요청</h3>
<p>아래에는 위와는 다르게 조금은 특별한(?) 요청을 하고 싶을 때 사용할 수 있는 기능들이다.</p>

<ul>
  <li>만약 에러를 그냥 회피하고 싶다면 except 블록에 <code class="highlighter-rouge">pass</code>를 입력하면 된다.</li>
  <li><code class="highlighter-rouge">Exception</code>이 발생하였을 때 프로그램을 중단하고 싶으면 <code class="highlighter-rouge">raise SystemExit</code>을 except 블록에 입력하면 된다.</li>
  <li><code class="highlighter-rouge">Exception</code>을 일부러 발생하고 싶을 때에도 <code class="highlighter-rouge">raise</code> 구문을 사용하면 된다.</li>
</ul>

<p>3번 째 경우에 대한 예시를 첨부하겠다. <code class="highlighter-rouge">BaseBandit</code>이라는 부모 class가 있고, 사용자는 이 부모 class를 상속받아 <code class="highlighter-rouge">TalkativeBandit</code>이라는 자식 class를 만들고 싶다고 하자.</p>

<p>그런데 이 때, 자식 class에 반드시 <code class="highlighter-rouge">operate</code>이란 메서드를 구현하도록 미리 설정을 해두고 싶다. 모니터 구석에 메모를 해두는 것 외에 방법이 없을까? 이 때 부모 class인 <code class="highlighter-rouge">BaseBandit</code>에 미리 아래와 같은 코드를 구현해 놓으면 원하는 바를 쟁취할 수 있을 것이다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 부모 class 구현
</span><span class="k">class</span> <span class="nc">BaseBandit</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">operate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="nb">NotImplementedError</span>

<span class="c1"># 자식 class 구현
</span><span class="k">class</span> <span class="nc">TalkativeBandit</span><span class="p">(</span><span class="n">BaseBandit</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">stay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Don't talk"</span><span class="p">)</span>

<span class="n">tb</span> <span class="o">=</span> <span class="n">TalkativeBandit</span><span class="p">()</span>

<span class="c1"># 자식 class에서는 operate 메서드를 구현하지 않았으므로
# 부모 class의 operate 메서드가 호출된다.
</span><span class="n">tb</span><span class="p">.</span><span class="n">operate</span><span class="p">()</span>

<span class="c1"># 에러가 발생한다.
</span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"C:\Users\...\interactiveshell.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2961</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run_code</span>
    <span class="k">exec</span><span class="p">(</span><span class="n">code_obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">user_global_ns</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">user_ns</span><span class="p">)</span>
  <span class="n">File</span> <span class="s">"&lt;ipython-input-17-fdf0f46c74b7&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="n">tb</span><span class="p">.</span><span class="n">operate</span><span class="p">()</span>
  <span class="n">File</span> <span class="s">"&lt;ipython-input-12-af85936c9668&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">3</span><span class="p">,</span> <span class="ow">in</span> <span class="n">operate</span>
    <span class="k">raise</span> <span class="nb">NotImplementedError</span>
<span class="nb">NotImplementedError</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">operate</code> 메서드를 제대로 구현한다면, 별 문제 없이 코드를 진행할 수 있을 것이다.</p>

<hr />

<h2 id="3-exception-추적">3. Exception 추적</h2>
<p>바로 위의 예시를 보자. <code class="highlighter-rouge">Traceback (most recent call last)</code>란 문구를 볼 수 있을 것이다. 이는 Exception을 역으로 추적한다는 뜻이다.</p>

<p>사용자가 직접 추적 과정을 만들고 싶을 때 stack trace를 표시하고 출력하는 <code class="highlighter-rouge">traceback</code> 모듈과 로그 기록을 관리하는 <code class="highlighter-rouge">logging</code> 모듈을 사용하면 편리하다.</p>

<p>가장 기초적인 추적 방법은 아래와 같다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">traceback</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">tuple</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">except</span> <span class="nb">IndexError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"--- Exception Occured ---"</span><span class="p">)</span>
    <span class="n">traceback</span><span class="p">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># 출력 결과
</span><span class="o">---</span> <span class="nb">Exception</span> <span class="n">Occured</span> <span class="o">---</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"&lt;ipython-input-19-0acccd16d042&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="nb">tuple</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">IndexError</span><span class="p">:</span> <span class="nb">tuple</span> <span class="n">index</span> <span class="n">out</span> <span class="n">of</span> <span class="nb">range</span>    
</code></pre></div></div>

<p>빈 튜플에 indexing을 시도했으므로 에러가 발생하는 것은 당연하다.<br />
그 에러는 <code class="highlighter-rouge">IndexError</code> 인데, 우리는 <code class="highlighter-rouge">traceback.print_exc</code> 메서드를 통해 stack trace 정보를 출력할 수 있다.</p>

<p><code class="highlighter-rouge">limit=None</code>이 기본이며 이 때는 제한 없이 stack trace를 출력한다. 위 예시와 같이 1을 입력하면 단 한 개의 stack trace 정보를 출력한다는 뜻이다. <code class="highlighter-rouge">file, chain</code> argument 설정을 통해 파일 출력 위치를 설정하거나 연쇄적인 Exception 출력 설정을 관리할 수 있다.</p>

<p>왜 이런 과정을 거쳐야 할까? 만약 이와 같이 try-except를 통해 Exception을 관리해주지 않는다면, 우리는 모든 에러를 잡기 전까지 프로그램 전체를 돌릴 수 없을 것이다.</p>

<p>이번에는 logging 모듈과 합작하여 Exception을 추적해보자.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="p">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">"example.log"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s">"%(asctime)s %(levelname)s %(message)s"</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">tuple</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">except</span> <span class="nb">IndexError</span><span class="p">:</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="p">.</span><span class="n">format_exc</span><span class="p">())</span>
    <span class="k">raise</span>

<span class="c1"># 출력 결과
</span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"C:\Users\...\interactiveshell.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2961</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run_code</span>
    <span class="k">exec</span><span class="p">(</span><span class="n">code_obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">user_global_ns</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">user_ns</span><span class="p">)</span>
  <span class="n">File</span> <span class="s">"&lt;ipython-input-18-16da8da0daa5&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">6</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="nb">tuple</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">IndexError</span><span class="p">:</span> <span class="nb">tuple</span> <span class="n">index</span> <span class="n">out</span> <span class="n">of</span> <span class="nb">range</span>
</code></pre></div></div>

<p>logging 모듈을 통해 우리는 <code class="highlighter-rouge">example.log</code>라는 파일에 에러에 관한 기록을 해둘 수 있었다.<br />
이 파일에는 다음과 같은 로그 기록이 남아있다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2020-01-12 18:38:50,633 ERROR Traceback (most recent call last):
  File "&lt;ipython-input-18-16da8da0daa5&gt;", line 6, in &lt;module&gt;
    tuple()[0]
IndexError: tuple index out of range
</code></pre></div></div>

<hr />

<h2 id="4-exception-만들기">4. Exception 만들기</h2>
<p><code class="highlighter-rouge">Exception</code> class 상속을 통해 Exception을 직접 만들 수 있다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="k">class</span> <span class="nc">SizeError</span><span class="p">(</span><span class="nb">Exception</span><span class="p">):</span>
    <span class="c1"># 에러 메시지를 출력하고 싶으면 아래와 같은 특별 메서드를 구현해야 한다.
</span>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"Size does not fit"</span>
    
<span class="c1"># 기준이 되는 base
</span><span class="n">base</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># 비교대상인 data
</span><span class="n">data1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>
<span class="n">data2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># np.array의 shape을 비교하는 함수이다.
</span><span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">base</span> <span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">base</span><span class="p">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">data</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SizeError</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"All Clear"</span><span class="p">)</span>

<span class="c1"># 첫 번째 테스트
</span><span class="n">compare</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data1</span><span class="p">)</span>

<span class="c1"># 첫 번째 결과
</span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"C:\Users\...\interactiveshell.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2961</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run_code</span>
    <span class="k">exec</span><span class="p">(</span><span class="n">code_obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">user_global_ns</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">user_ns</span><span class="p">)</span>
  <span class="n">File</span> <span class="s">"&lt;ipython-input-36-c1718418c4b8&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="n">compare</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data1</span><span class="p">)</span>
  <span class="n">File</span> <span class="s">"&lt;ipython-input-35-8ec7197ddfb7&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">3</span><span class="p">,</span> <span class="ow">in</span> <span class="n">compare</span>
    <span class="k">raise</span> <span class="n">SizeError</span><span class="p">()</span>
<span class="n">SizeError</span><span class="p">:</span> <span class="n">Size</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">fit</span>

<span class="c1"># 두 번째 테스트
</span><span class="n">compare</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data2</span><span class="p">)</span>

<span class="c1"># 두 번째 결과
</span><span class="n">All</span> <span class="n">Clear</span>
</code></pre></div></div>

<hr />

<h2 id="reference">Reference</h2>
<blockquote>
  <p><a href="https://docs.python.org/3/library/exceptions.html">파이썬 공식문서</a><br />
<a href="https://m.blog.naver.com/PostView.nhn?blogId=wideeyed&amp;logNo=221576227901&amp;proxyReferer=https%3A%2F%2Fwww.google.com%2F">참고 블로그1</a>
<a href="https://wikidocs.net/30">참고 블로그2</a></p>
</blockquote>


    </article>
    <div class="post-more">
      
      <a href="/error/#disqus_thread"> <i class="fa fa-comments" aria-hidden="true"></i>Comment</a>&nbsp;
      
      <a href="/error/"><i class="fa fa-plus-circle" aria-hidden="true"></i>Read more</a>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/zip/">
        파이썬 압축 모듈 간단 예시
      </a>
    </h1>

    <span class="post-date">11 Jan 2020</span>
     |
    
    <a href="/blog/tags/#references" class="post-tag">References</a>
    
    <a href="/blog/tags/#파이썬" class="post-tag">파이썬</a>
    
    

    <article>
      <h2 id="1-zlib-모듈">1. zlib 모듈</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">zlib</span>

<span class="n">long_text</span> <span class="o">=</span> <span class="s">b"who are you"</span> <span class="o">*</span> <span class="mi">1000</span>
<span class="c1"># 압축하기
</span><span class="n">compressed</span> <span class="o">=</span> <span class="n">zlib</span><span class="p">.</span><span class="n">compress</span><span class="p">(</span><span class="n">long_text</span><span class="p">)</span>

<span class="c1"># 압축 풀기
</span><span class="n">decompressed</span> <span class="o">=</span> <span class="n">zlib</span><span class="p">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span>

<span class="c1"># 동일한지 확인
</span><span class="k">print</span><span class="p">(</span><span class="n">long_text</span> <span class="o">==</span> <span class="n">decompressed</span><span class="p">)</span>

<span class="bp">True</span>
</code></pre></div></div>

<hr />

<h2 id="2-gzip-모듈">2. gzip 모듈</h2>
<p>위에서 사용한 zlib 모듈과 동일하게 compress, decompress 메서드를 사용한다. 파일을 열 때는 <code class="highlighter-rouge">open</code> 메서드를 이용하면 된다. 여는 작업에 대한 코드만 첨부한다. bzip2(bz2), lzma(xz) 형식 파일에 대해서도 유사한 메서드를 이용한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">gzip</span>

<span class="k">with</span> <span class="n">gzip</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">"data.gz"</span><span class="p">,</span> <span class="s">"rt"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="3-zipfile-모듈">3. zipfile 모듈</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">zipfile</span>

<span class="c1"># zip 파일이 맞는지 확인
</span><span class="n">zipfile</span><span class="p">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="s">"trasnactions.zip"</span><span class="p">)</span>

<span class="c1"># zip 파일 열기
</span><span class="nb">zip</span> <span class="o">=</span> <span class="n">zipfile</span><span class="p">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="s">"trasnactions.zip"</span><span class="p">)</span>

<span class="c1"># zip 파일 내 이름 확인 및 추후 사용을 위해 저장
</span><span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">.</span><span class="n">namelist</span><span class="p">():</span>
    <span class="n">names</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>

<span class="p">[</span><span class="s">'transaction1.txt'</span><span class="p">,</span> <span class="s">'transaction2.txt'</span><span class="p">]</span>

<span class="c1"># 첫 번째 파일 압축 해제 과정
# 하나만 압축 해제할 때
# ZipInfo 얻기
</span><span class="n">zipinfo</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">.</span><span class="n">getinfo</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Filename: "</span><span class="p">,</span> <span class="n">zipinfo</span><span class="p">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">"date_time: "</span><span class="p">,</span> <span class="n">zipinfo</span><span class="p">.</span><span class="n">date_time</span><span class="p">)</span>

<span class="n">Filename</span><span class="p">:</span>  <span class="n">transaction1</span><span class="p">.</span><span class="n">txt</span> <span class="n">date_time</span><span class="p">:</span>  <span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>

<span class="nb">zip</span><span class="p">.</span><span class="n">extract</span><span class="p">(</span><span class="n">zipinfo</span><span class="p">)</span>

<span class="c1"># 전부 압축 해제할 때
</span><span class="nb">zip</span><span class="p">.</span><span class="n">extractall</span><span class="p">()</span>

<span class="c1"># 끝나고 닫아주기
</span><span class="nb">zip</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="4-tarfile-모듈">4. tarfile 모듈</h2>
<p>위와 유사하다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">tarfile</span>

<span class="c1"># tarfile이 맞는지 확인
</span><span class="n">tarfile</span><span class="p">.</span><span class="n">is_tarfile</span><span class="p">(</span><span class="s">"transactions.tar"</span><span class="p">)</span>

<span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">"transactions.tar"</span><span class="p">)</span>
<span class="n">tar</span><span class="p">.</span><span class="n">getnames</span><span class="p">()</span>

<span class="p">[</span><span class="s">'transaction1.txt'</span><span class="p">,</span> <span class="s">'transaction2.txt'</span><span class="p">]</span>

<span class="c1"># 하나만 압축 해제
</span><span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tar</span><span class="p">.</span><span class="n">getmember</span><span class="p">(</span><span class="n">tar</span><span class="p">.</span><span class="n">getnames</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">tarinfo</span><span class="p">.</span><span class="n">size</span><span class="p">,</span> <span class="n">tarinfo</span><span class="p">.</span><span class="n">mtime</span><span class="p">,</span> <span class="n">tarinfo</span><span class="p">.</span><span class="n">mode</span><span class="p">)</span>

<span class="n">transaction1</span><span class="p">.</span><span class="n">txt</span> <span class="mi">74</span> <span class="mi">1578739467</span> <span class="mi">493</span>

<span class="n">tar</span><span class="p">.</span><span class="n">extract</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">)</span>

<span class="c1"># 전체 압축 해제
</span><span class="n">tar</span><span class="p">.</span><span class="n">extractall</span><span class="p">()</span>
<span class="n">tar</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="reference">Reference</h2>
<blockquote>
  <p>파이썬 라이브러리 레시피, 프리렉
https://docs.python.org/3/library/zipfile.html
https://docs.python.org/3/library/tarfile.html</p>
</blockquote>

    </article>
    <div class="post-more">
      
      <a href="/zip/#disqus_thread"> <i class="fa fa-comments" aria-hidden="true"></i>Comment</a>&nbsp;
      
      <a href="/zip/"><i class="fa fa-plus-circle" aria-hidden="true"></i>Read more</a>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/collections-heapq/">
        파이썬 collections, heapq 모듈 설명
      </a>
    </h1>

    <span class="post-date">10 Jan 2020</span>
     |
    
    <a href="/blog/tags/#references" class="post-tag">References</a>
    
    <a href="/blog/tags/#파이썬" class="post-tag">파이썬</a>
    
    

    <article>
      <h2 id="1-collections-모듈">1. collections 모듈</h2>
<h3 id="11-collectionscounter-객체">1.1. collections.Counter 객체</h3>
<p>collections 모듈에서 가장 기본을 이루는 class는 <code class="highlighter-rouge">collections.Counter</code>이다. 이 class에 argument로 반복 가능한 (iterable) 객체를 지정하거나 dictionary와 같은 mapping 객체를 지정하면 Counter 객체를 생성할 수 있다. 예를 들어보면,</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">collections</span>

<span class="n">counter</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="n">Counter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="c1"># counter = collections.Counter({1: 1, 2: 2, 3: 1})
</span><span class="k">print</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>

<span class="n">Counter</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</code></pre></div></div>

<p>주석 처리된 line이 바로 후자의 방법에 해당한다. 이렇게 생성된 객체는 수정될 수 있다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">counter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>

<span class="n">Counter</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</code></pre></div></div>

<p>이 외에도 여러 계산이 가능한데, 아래를 참고하길 바란다.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">연산자</th>
      <th style="text-align: center">설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">-=</td>
      <td style="text-align: center">뺀다. 결과가 음수면 그 요소는 삭제된다.</td>
    </tr>
    <tr>
      <td style="text-align: center">&amp;=</td>
      <td style="text-align: center">좌변의 Counter 객체 요소 중 우변의 Counter 객체 요소에 미포함되어 있는 <br /><br /> key의 요소를 삭제한다. 요소의 값은 둘 중 작은 쪽의 값이 된다.</td>
    </tr>
    <tr>
      <td style="text-align: center">l=</td>
      <td style="text-align: center">2개의 Counter 객체 전체의 요소로부터 새롭게 Counter 객체를 생성한다. <br /><br /> key가 같으면 두 값 중 큰 쪽의 값이 된다.</td>
    </tr>
  </tbody>
</table>

<p>위 누계 연산자에서 =를 빼고 <code class="highlighter-rouge">+, -, &amp;, |</code> 만 사용할 경우 이항 연산자로 작용한다.</p>

<p>또한, 이 객체에서 미등록 key를 참조한다 하더라도 KeyError는 발생하지 않는다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">counter</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

<span class="mi">0</span>
</code></pre></div></div>

<h3 id="12-collectionschainmap-사전-통합">1.2. collections.ChainMap: 사전 통합</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dict1</span> <span class="o">=</span> <span class="p">{</span><span class="s">'banana'</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">dict2</span> <span class="o">=</span> <span class="p">{</span><span class="s">'apple'</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

<span class="n">counter</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="n">ChainMap</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">counter</span><span class="p">[</span><span class="s">'apple'</span><span class="p">])</span>

<span class="mi">2</span>
</code></pre></div></div>

<p>위와 같이 ChainMap 메서드는 여러 사전 객체를 모아 하나로 통합하는 기능을 갖고 있다. 만약 통합한 객체에 변화를 줄 경우, 원래의 사전들에도 그 변경 사항이 반영된다. <code class="highlighter-rouge">clear</code> 메서드를 사용하면 사전을 삭제할 수 있다.</p>

<h3 id="13-collectionsdefaultdict-기본-값이-있는-사전">1.3. collections.defaultdict: 기본 값이 있는 사전</h3>
<p>일반적으로 사전 객체에 미등록된 key를 참조하면 KeyError가 발생한다. <code class="highlighter-rouge">collections.defaultdict</code>는 이러한 문제를 해결하기에 적합한 객체이다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">'orange'</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">get_default_value</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">'default-value'</span>

<span class="c1"># 여기서 get_default_value와 같은 callable 객체나 None을 입력할 수 있다.
# None을 입력할 경우 일반 사전과 마찬가지로 KeyError가 발생한다.
</span><span class="n">e</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">get_default_value</span><span class="p">,</span> <span class="n">orange</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">'ham'</span><span class="p">])</span>

<span class="s">'default-value'</span>
</code></pre></div></div>

<p>만약 기본 값으로 수치 0이나 빈 사전, 리스트를 반환하고 싶다면 int, dict, list형 객체를 지정하면 된다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">e</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="14-collectionsordereddict-순서가-있는-사전">1.4. collections.OrderedDict: 순서가 있는 사전</h3>
<p><strong>for loop</strong>와 같은 과정 속에서 등록한 순서대로 요소를 추출하고 싶으면 이 class를 이용하면 좋다. 시퀀스를 이용하여 객체를 생성하면 순서대로 등록된 것을 확인할 수 있다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mydict</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="n">OrderedDict</span><span class="p">([(</span><span class="s">"orange"</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="s">"banana"</span><span class="p">,</span> <span class="mi">20</span><span class="p">)])</span>
<span class="k">print</span><span class="p">(</span><span class="n">mydict</span><span class="p">)</span>

<span class="n">OrderedDict</span><span class="p">([(</span><span class="s">'orange'</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="s">'banana'</span><span class="p">,</span> <span class="mi">20</span><span class="p">)])</span>
</code></pre></div></div>

<p>그러나 키워드 인수나 일반 사전으로 초깃값을 등록하면 순서가 무시된다. <code class="highlighter-rouge">OrderedDict</code> 객체에는 유용한 기능들이 있는데, 아래를 참조하면 좋을 것이다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mydict</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="n">OrderedDict</span><span class="p">([(</span><span class="s">"orange"</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="s">"banana"</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="p">(</span><span class="s">"blueberry"</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">(</span><span class="s">"mango"</span><span class="p">,</span> <span class="mi">40</span><span class="p">)])</span>

<span class="c1"># popitem 에서 last=True로 하면 마지막 요소를 사전에서 삭제하고 반환하고,
# False로 하면 첫 요소에 효과를 적용한다.
</span><span class="n">mydict</span><span class="p">.</span><span class="n">popitem</span><span class="p">(</span><span class="n">last</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># move_to_end에서 last=True로 하면 지정한 키를 맨 끝으로 이동시키고, False이면 맨 처음으로 이동시킨다.
</span><span class="n">mydict</span><span class="p">.</span><span class="n">move_to_end</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s">"banana"</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">mydict</span><span class="p">)</span>

<span class="n">OrderedDict</span><span class="p">([(</span><span class="s">'orange'</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="s">'blueberry'</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">(</span><span class="s">'banana'</span><span class="p">,</span> <span class="mi">20</span><span class="p">)])</span>
</code></pre></div></div>

<h3 id="15-collectionsnamedtuple">1.5. collections.namedtuple</h3>
<p>데이터를 효율적으로 관리하기에 적합한 class가 바로 namedtuple이다. 속성 이름을 지정하여 가독성을 높이고 튜플을 활용하여 원하는 요소를 쉽게 추출하도록 하게 해준다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">point</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s">"point"</span><span class="p">,</span> <span class="s">"X, Y, Z"</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">point</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span>

<span class="mi">6</span>
</code></pre></div></div>

<hr />

<h2 id="2-heapq-모듈">2. heapq 모듈</h2>
<p>데이터를 정렬된 상태로 저장하고, 이를 바탕으로 효율적으로 최솟값을 반환하기 위해서는 이 <strong>heapq</strong> 모듈을 사용하면 매우 편리하다. 사용하기 위해서는 최소 heap을 먼저 생성해야 한다. 빈 리스트를 생성해서 heapq 모듈의 메서드를 호출할 때마다 이를 heap argument의 인자로 투입해야 한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">heapq</span>

<span class="n">heap</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># heappush(heap, item): heap에 item을 추가함
# 주의점: keyword 인자를 입력하면 Error가 발생함
</span><span class="n">heaqp</span><span class="p">.</span><span class="n">heappush</span><span class="p">(</span><span class="n">heap</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">heaqp</span><span class="p">.</span><span class="n">heappush</span><span class="p">(</span><span class="n">heap</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># heappop(heap): heap에서 최솟값을 삭제하고 그 값을 반환함
# 최솟값을 삭제하지 않고 참조하고 싶다면 heap[0]을 쓰자
</span><span class="n">heapq</span><span class="p">.</span><span class="n">heappop</span><span class="p">(</span><span class="n">heap</span><span class="p">)</span>

<span class="mi">1</span>
</code></pre></div></div>

<p>이 외에도 여러 메서드를 사용할 수 있다. 만약 어떤 변화하는 시퀀스에서 최솟값을 얻고 싶다고 하자. 아래와 같은 코딩이 가능하다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">heap</span> <span class="o">=</span> <span class="p">[</span><span class="mi">79</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">62</span><span class="p">]</span>

<span class="c1"># heapify(heap): heap의 요소를 정렬함
</span><span class="n">heapq</span><span class="p">.</span><span class="n">heapify</span><span class="p">(</span><span class="n">heap</span><span class="p">)</span>

<span class="c1"># heappush(heap, item): heap에 item을 추가한 뒤, 최솟값을 삭제하고 그 값을 반환함
</span><span class="n">heapq</span><span class="p">.</span><span class="n">heappushpop</span><span class="p">(</span><span class="n">heap</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="mi">10</span>

<span class="c1"># heapreplace(heap, item): 최솟값을 삭제한 뒤, heap에 item을 추가하고 삭제한 값을 반환함
# 주의점: 추가한 값 아님
</span><span class="n">heapq</span><span class="p">.</span><span class="n">heapreplace</span><span class="p">(</span><span class="n">heap</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="mi">24</span>
</code></pre></div></div>

<hr />

<h2 id="reference">Reference</h2>
<blockquote>
  <p>파이썬 라이브러리 레시피, 프리렉</p>
</blockquote>

    </article>
    <div class="post-more">
      
      <a href="/collections-heapq/#disqus_thread"> <i class="fa fa-comments" aria-hidden="true"></i>Comment</a>&nbsp;
      
      <a href="/collections-heapq/"><i class="fa fa-plus-circle" aria-hidden="true"></i>Read more</a>
    </div>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/blog/page3">Older</a>
  
  
    
      <a class="pagination-item newer" href="/blog/">Newer</a>
    
  
</div>


  </div>
</div>

<label for="sidebar-checkbox" class="sidebar-toggle"></label>

<script>
  (function (document) {
    let toggle = document.querySelector('.sidebar-toggle');
    let sidebar = document.querySelector('#sidebar');
    let checkbox = document.querySelector('#sidebar-checkbox');

    document.addEventListener('click', function (e) {
      let target = e.target;

      if (target === toggle) {
        checkbox.checked = !checkbox.checked;
        e.preventDefault();
      } else if (checkbox.checked && !sidebar.contains(target)) {
        /* click outside the sidebar when sidebar is open */
        checkbox.checked = false;
      }
    }, false);
  })(document);
</script>

<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    };
    i[r].l = 1 * new Date();
    a = s.createElement(o);
    m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

  ga('create', 'UA-00000000-1', 'auto');
  ga('send', 'pageview');
</script>


<!-- Naver Analytics -->	
<script type="text/javascript" src="//wcs.naver.net/wcslog.js"></script>
<script type="text/javascript">
  if(!wcs_add) var wcs_add = {};
    wcs_add["wa"] = "18cbce78e94161";
  wcs_do();
</script>

</body>

<script id="dsq-count-scr" src="//greeksharifa-github-io.disqus.com/count.js" async></script>

</html>
