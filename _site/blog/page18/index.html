<!DOCTYPE html>
<html lang="en-us">
<head>
  <head>
  <!-- Description of Blog -->
  <meta name="description" content="Python, Machine & Deep Learning">
  <link rel="canonical" href="https://greeksharifa.github.io/">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Python, Machine & Deep Learning">
  <meta property="og:description" content="Python, Machine Learning & Deep Learning 설명서">
  <meta property="og:image" content="https://greeksharifa.github.io/public/img/icon-144x144.png">
  <meta property="og:url" content="https://greeksharifa.github.io/">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Python, Machine & Deep Learning">
  <meta name="twitter:description" content="Python, Machine Learning & Deep Learning 설명서">
  <meta name="twitter:image" content="https://greeksharifa.github.io/public/img/icon-144x144.png">
  <meta name="twitter:domain" content="https://greeksharifa.github.io/">

  <!-- link -->
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/main.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="icon-144x144" sizes="144x144" href="/public/img/icon-144x144.png">
  <link rel="shortcut icon" href="/public/img/icon_32x32.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  
  <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_SVG"> </script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } });
  </script>
  

  <!-- Ads -->
  <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
  </script>
</head>

  <!-- for Google AdSense-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-9951774327887666",
    enable_page_level_ads: true
  });
</script>

  <style>blockquote {
    font-size: 1em;
    line-height: 1.4
  }</style>
  <link href='http://fonts.googleapis.com/css?family=Gill+Sans' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Consolas' rel='stylesheet' type='text/css'>
</head>
<body>

<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <div class="sidebar-personal-info">
      <div class="sidebar-personal-info-section">
        <a href="http://gravatar.com/3c2986ad7ac1f2230ea3596f44563328">
          <img src="/public/img/maple_tree.jpg" title="Cover Photo" alt="Maple tree" />
        </a>
      </div>
      <div class="sidebar-personal-info-section">
        <p><strong>Developer and Analyst</strong>, YW & YY.</p>
      </div>
      
      
      
      <div class="sidebar-personal-info-section">
        <p> Follow me:
        
        
        
        <a href="https://github.com/greeksharifa">
          <i class="fa fa-github" aria-hidden="true"></i>
        </a>
        
        |
        
        
        
        <a href="mailto:greeksharifa@gmail.com">
          <i class="fa fa-envelope" aria-hidden="true"></i>
        </a>
        
        
        
        </p>
      </div>
      
    </div>
  </div>

  <nav class="sidebar-nav">
    
      
      
      

      

      <span class="">
        <a class="sidebar-nav-item " href="/">
          Home
        </a>

        
      </span>

    
      
      
      

      

      <span class="foldable">
        <a class="sidebar-nav-item " href="/blog/">
          Blog
        </a>

        
          
            
            
            
              <a class="sidebar-nav-item sidebar-nav-item-sub " href="/blog/categories/">
                Categories
              </a>
          
        
          
            
            
            
              <a class="sidebar-nav-item sidebar-nav-item-sub " href="/blog/tags/">
                Tags
              </a>
          
        
      </span>

    
      
      
      

      

      <span class="">
        <a class="sidebar-nav-item " href="/about/">
          About
        </a>

        
      </span>

    
      
      
      

      

      <span class="">
        <a class="sidebar-nav-item " href="http://greeksharifa.github.io/">
          Github Project
        </a>

        
      </span>

    

  </nav>

  <div class="sidebar-item">
    <p>
    &copy; 2020 YW & YY. This work is liscensed under <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a>.
    </p>
  </div>

  <div class="sidebar-item">
    <p>
    Powered by <a href="http://jekyllrb.com">jekyll</a> and <a href="http://greeksharifa.github.io">YW & YY</a>
    </p>
  </div>
</div>


<!-- Wrap is the content to shift when toggling the sidebar. We wrap the
     content to avoid any CSS collisions with our real content. -->
<div class="wrap">
  <div class="masthead">
    <div class="container">
      <h3 class="masthead-title" align="center">
        <a href="/" title="Home" title="YW & YY">
          <img class="masthead-logo" src="/public/img/logo.png"/>
        </a>
        <small>YW & YY's Python, Machine & Deep Learning</small>
        <!-- HTML elements for search -->
        <a href="/search/" id="search_icon">
          <img src="/public/img/search.png" width="25" height="25"
               align="right" style="margin-top:5px; margin-bottom:0;"
               onmouseover="this.style.opacity=0.7" onmouseout="this.style.opacity=0.5"
               alt="search">
        </a>
      </h3>
    </div>
  </div>

  <div class="container content">
    <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/algorithm%20&%20data%20structure/2018/07/07/algorithm-FFT/">
        고속 푸리에 변환(Fast Fourier Theorem, FFT). 큰 수의 곱셈
      </a>
    </h1>

    <span class="post-date">07 Jul 2018</span>
     |
    
    <a href="/blog/tags/#fft" class="post-tag">FFT</a>
    
    

    <article>
      <h2 id="참조">참조</h2>

<table>
  <thead>
    <tr>
      <th>분류</th>
      <th>URL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>문제</td>
      <td><a href="https://www.acmicpc.net/problem/13277">큰 수 곱셈</a></td>
    </tr>
    <tr>
      <td>응용 문제</td>
      <td><a href="https://www.acmicpc.net/workbook/view/824">koosaga BOJ FFT 문제집</a></td>
    </tr>
    <tr>
      <td><a href="https://greeksharifa.github.io/algorithm%20&amp;%20data%20structure/2018/07/07/algorithm-library/">참조 라이브러리</a></td>
      <td><a href="https://github.com/greeksharifa/ps_code/blob/master/library/sharifa_header.h">sharifa_header.h</a>, <a href="https://github.com/greeksharifa/ps_code/blob/master/library/bit_library.h">bit_library.h</a></td>
    </tr>
    <tr>
      <td>이 글에서 설명하는 라이브러리</td>
      <td><a href="https://github.com/greeksharifa/ps_code/blob/master/library/fft.h">fft.h</a></td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="개요">개요</h2>

<h3 id="시간복잡도--on-log-n-">시간복잡도: $ O(N log N) $</h3>
<h3 id="공간복잡도--on-">공간복잡도: $ O(N) $</h3>
<ul>
  <li>N은 두 수열의 길이의 max값이다.</li>
  <li>FFT는 convolution을 빠르게 해 주는 것이지만, PS에서는 거의 대부분 곱셈을 빠르게 하기 위해 쓰인다.</li>
</ul>

<p>이 글에서는 FFT(고속 푸리에 변환)을 설명한다.<br />
이론적인 부분에 대한 자세한 설명은 <a href="http://topology-blog.tistory.com/6">topology-blog</a>에 잘 되어 있으므로 생략한다.</p>

<hr />

<h2 id="알고리즘">알고리즘</h2>

<p>큰 수의 곱셈을 수행할 때 FFT의 개략적인 설명은 다음과 같이 적어 두었다.</p>

<ol>
  <li>각 수열을 먼저 reverse시킨다. $ O(N) $</li>
  <li>각 수열에 푸리에 변환을 적용한다. $ O(N log N) $</li>
  <li>푸리에 변환을 적용하면 convolution을 단순 곱셈으로 변환시킬 수 있으므로, 2의 결과물을 element-wise 곱셈을 시킨다. $ O(N) $</li>
  <li>3의 결과물을 푸리에 역변환을 시킨다. $ O(N log N) $</li>
  <li>1에서 reverse를 시켰으므로, 다시 reverse를 시켜준다. $ O(N) $</li>
</ol>

<p>FFT의 핵심 부분은 2~4번 부분이다. 1번과 5번은 우리가 수를 쓸 때 앞부분에 큰 자리 수를 적기 때문에 필요하다.</p>

<h2 id="구현">구현</h2>

<p>다음과 같다. FFT 구현과 출력 함수만 정의되어 있으므로, 따로 설명하진 않겠다.</p>

<p>다만 주의할 점이 하나 있는데, 출력 함수에서 곱하는 두 수가 0인 경우 예외 처리를 해주어야 한다.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
fft 함수는 http://topology-blog.tistory.com/6 블로그를 참조한 것입니다.
*/</span>

<span class="cp">#pragma once
</span>
<span class="cp">#include "sharifa_header.h"
#include "bit_library.h"
</span>
<span class="k">typedef</span> <span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">base</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">fft</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">base</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">inv</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">bit</span> <span class="o">=</span> <span class="n">n</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="n">j</span> <span class="o">^=</span> <span class="n">bit</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">bit</span><span class="p">))</span> <span class="n">bit</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">)</span> <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">inv</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">base</span> <span class="n">w</span> <span class="o">=</span> <span class="p">{</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">};</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">base</span> <span class="n">th</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">base</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">th</span><span class="p">;</span>
                <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">tmp</span><span class="p">;</span>
                <span class="n">a</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">;</span>
                <span class="n">th</span> <span class="o">*=</span> <span class="n">w</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">inv</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">multiply</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">base</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">A</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">base</span><span class="o">&gt;</span> <span class="n">b</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">B</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">power_of_2_ge_than</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">()))</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>

    <span class="n">a</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>	<span class="n">b</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="n">fft</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>	<span class="n">fft</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">fft</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ret</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">round</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">real</span><span class="p">());</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="boj-13277큰-수-곱셈-문제-풀이">BOJ 13277(큰 수 곱셈) 문제 풀이</h2>

<p>문제: <a href="https://www.acmicpc.net/problem/13277">BOJ 13277(큰 수 곱셈)</a></p>

<p>풀이: <a href="https://greeksharifa.github.io/ps/2018/07/08/PS-13277/">BOJ 13277(큰 수 곱셈) 문제 풀이</a></p>

    </article>
    <div class="post-more">
      
      <a href="/algorithm%20&%20data%20structure/2018/07/07/algorithm-FFT/#disqus_thread"> <i class="fa fa-comments" aria-hidden="true"></i>Comment</a>&nbsp;
      
      <a href="/algorithm%20&%20data%20structure/2018/07/07/algorithm-FFT/"><i class="fa fa-plus-circle" aria-hidden="true"></i>Read more</a>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/ps/2018/07/07/PS-06549/">
        BOJ 06549(히스토그램에서 가장 큰 직사각형) 문제 풀이
      </a>
    </h1>

    <span class="post-date">07 Jul 2018</span>
     |
    
    <a href="/blog/tags/#ps" class="post-tag">PS</a>
    
    <a href="/blog/tags/#stack" class="post-tag">Stack</a>
    
    

    <article>
      <h2 id="참조">참조</h2>

<table>
  <thead>
    <tr>
      <th>분류</th>
      <th>URL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>문제</td>
      <td><a href="https://www.acmicpc.net/problem/6549">히스토그램에서 가장 큰 직사각형</a></td>
    </tr>
    <tr>
      <td>이 글에서 설명하는 코드</td>
      <td><a href="https://github.com/greeksharifa/ps_code/blob/master/BOJ/06549_%ED%9E%88%EC%8A%A4%ED%86%A0%EA%B7%B8%EB%9E%A8%EC%97%90%EC%84%9C%20%EA%B0%80%EC%9E%A5%20%ED%81%B0%20%EC%A7%81%EC%82%AC%EA%B0%81%ED%98%95.cpp">06549_히스토그램에서 가장 큰 직사각형</a></td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="개요">개요</h2>

<h3 id="시간복잡도--otc-cdot-n-">시간복잡도: $ O(TC \cdot N) $</h3>
<h3 id="공간복잡도--on-">공간복잡도: $ O(N) $</h3>
<ul>
  <li>N은 직사각형의 수, TC는 테스트 케이스의 수이다. 즉 사실상 $ O(N) $이다.</li>
</ul>

<p>이 글에서는 <a href="https://www.acmicpc.net/problem/6549">히스토그램에서 가장 큰 직사각형</a>의 가장 빠른 풀이인 스택을 활용한 풀이를 설명한다.<br />
이 문제는 BOJ 사이트 맨 아래에 적혀 있는 대로 세그먼트 트리($O(N log N)$), 분할 정복($O(N log N)$) 등으로도 풀 수 있다.</p>

<hr />

<h2 id="문제-풀이">문제 풀이</h2>

<p><del>개인적으로 스택 활용 문제 중 가장 멋있는 문제라고 생각…</del></p>

<p>이 문제는 처음 봤을 때는 스택이라는 것을 떠올리기가 굉장히 까다롭다. 하지만 가장 멋있는 풀이 방법이니 꼭 익혀두도록 하자.</p>

<p>우선 $O(N^2)$ 풀이부터 생각해 보자.</p>

<h3 id="on2-풀이-그냥-풀기">$O(N^2)$ 풀이: 그냥 풀기</h3>

<p>사실 이 풀이는 별 것 없다. N개의 직사각형이 있으니, [0, N) 구간이라고 생각하고, 모든 구간의 넓이를 다 구해보는 것이다. 그리고 최댓값을 찾는다.</p>

<ol>
  <li>[0, 1) 부터 [0, 2), [0, 3), …, [0, N) 구간을 검사한다. 각 구간 최댓값을 유지하면서 차례로 검사한다.</li>
  <li>[1, 2) 부터 [1, 3), [1, 4), …, [1, N) 구간을 검사한다. 각 구간 최댓값을 유지하면서 차례로 검사한다.</li>
  <li>…</li>
  <li>[N-1, N) 구간을 검사한다. 각 구간 최댓값을 유지하면서 차례로 검사한다(하나뿐이지만).</li>
  <li>이 중 최댓값을 찾는다.</li>
</ol>

<p>당연히 $O(N^2)$ 풀이는 시간 초과를 얻는다. 이를 $O(N)$으로 줄이기 위해서는, 한 칸씩 검사할 때마다 $O(N)$에 해당하는 구간을 검사해야 한다.<br />
그리고 이를 가능하게 해 주는 것이 스택이다.</p>

<h3 id="on-풀이-스택">$O(N)$ 풀이: 스택</h3>

<p>이 풀이를 어떻게 생각해냈을까라는 생각은 잠시 접어두고, 우선 풀이를 보자.</p>

<ol>
  <li>스택을 하나 생성하고, 답(ans)은 0으로 초기화해 둔다.</li>
  <li>0번째 직사각형을 처리한다. (첫 번째 직사각형이지만, 0으로 시작하는 것이 편하다)
    <ol>
      <li>0번째는 우선 스택에 집어넣어 둔다. 이 때 pair&lt;int, int&gt;를 사용하여, (위치, 직사각형의 높이)를 같이 저장한다.</li>
    </ol>
  </li>
  <li>i번째 직사각형을 처리한다.
    <ol>
      <li>이때 스택에는 몇 개인지는 모르지만 (위치, 직사각형의 높이) 쌍이 몇 개 들어 있을 것이다.</li>
      <li>스택의 top element의 높이와 i번째 직사각형의 높이를 비교한다. top element를 (top_index, top_height), i번째 직사각형을 (i_index, i_height)라고 하자.</li>
      <li>top_height &lt;= i_height이면(혹은 3.iv.b에서 다 제거해버려서 스택이 비었으면) (<strong>최소 위치</strong>, 직사각형의 높이) 쌍을 스택에 집어넣고 (i+1)번째 직사각형으로 넘어간다.
        <ol>
          <li>top_height == i_height이면 집어넣지 않아도 상관없지만, 코드가 복잡해지므로 그냥 한 번에 처리한다.</li>
          <li><strong>최소 높이</strong>란, min(i_height, 마지막으로 제거한 top_height)를 의미한다. 제거한 적이 없으면 그냥 i_height이다.</li>
        </ol>
      </li>
      <li>top_height &gt; i_height이면, 다음을 수행한다.
        <ol>
          <li>(i_index - top_index) * top_height와 ans의 max값을 ans에 넣는다.</li>
          <li>top element를 제거한다. 이때 top_height는 임시저장한다.</li>
        </ol>
      </li>
      <li>모든 직사각형을 처리했으면, 남은 스택의 top element에 대해서 iv의 동작을 반복한다.
        <ol>
          <li>이때 i_index 대신 n을 사용한다.</li>
        </ol>
      </li>
    </ol>
  </li>
</ol>

<p>이것이 알고리즘의 전부이다.<br />
BOJ의 예시(2 1 4 5 1 3 3)를 적용해 보자. 아래 그림은 BOJ에서 가져온 것이다.</p>

<p><img src="/public/img/PS/2018-07-07-PS-06549/01_histogram.png" alt="Histogram" /></p>

<ol>
  <li>스택을 하나 생성하고, ans 변수는 0으로 초기화해 둔다.</li>
  <li>0번째 직사각형을 처리한다.
    <ol>
      <li>(0,2)를 저장한다.</li>
    </ol>
  </li>
  <li>1번째 직사각형을 처리한다.
    <ol>
      <li>(0,2)가 스택에 있다.</li>
      <li>(0,2)와 (1,1)을 비교한다. 1번째 직사각형이 top element보다 더 작다.
        <ol>
          <li>(i_index - top_index) * top_height = (1-0)*2 = 2를 ans에 저장한다.
            <ul>
              <li>이것은 0번째 직사각형만을 사용하여 잘라낸 직사각형을 의미한다. 너비 1, 높이 2짜리 직사각형이다.</li>
            </ul>
          </li>
          <li>(0,2)를 스택에서 제거한다. 이때 <strong>최소 위치</strong>는 0이 된다.</li>
        </ol>
      </li>
      <li>스택이 비었으므로 (0,1)을 집어넣고(<strong>(1,1)이 아니다!</strong>) 다음으로 넘어간다.
        <ul>
          <li>이것의 의미는 다음과 같다. 위치는 0, 높이는 1을 집어넣었다. 이는 1번째 직사각형을 포함하는(높이 1 이상) 잘라낸 직사각형의 왼쪽 끝은 0이 된다는 뜻이다.</li>
          <li>그림을 보면 이해가 될 것이다. 0,1번째 직사각형 모두에서 잘라낼 때 최대 높이는 1이다.</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>2번째 직사각형을 처리한다.
    <ol>
      <li>(0,1)이 스택이 있다.</li>
      <li>(0,1)과 (2,4)를 비교한다. 2번째 직사각형이 top element보다 더 크다.</li>
      <li>(2,4)를 스택에 넣고 다음으로 넘어간다.</li>
    </ol>
  </li>
  <li>3번째 직사각형을 처리한다.
    <ol>
      <li>(0,1)과 (2,4)가 스택에 있다.</li>
      <li>(2,4)와 (3,5)를 비교한다. (3,5)를 스택에 넣고 다음으로 넘어간다.</li>
    </ol>
  </li>
  <li>4번째 직사각형을 처리한다.
    <ol>
      <li>(0,1), (2,4), (3,5)가 스택에 있다.</li>
      <li>(3,5)와 (4,1)을 비교한다. 4번째 직사각형이 더 작다.
        <ol>
          <li>(4-3)*5 = 5를 ans에 저장한다.
            <ul>
              <li>3번째 직사각형만을 사용하여 잘라낸 것을 의미한다.</li>
            </ul>
          </li>
          <li>(3,5)를 스택에서 제거한다. <strong>최소 위치</strong>를 3으로 업데이트한다.</li>
        </ol>
      </li>
      <li>(2,4)와 (4,1)을 비교한다. 이번에도 4번째 직사각형이 더 작다.
        <ol>
          <li>(4-2)<em>4 = 8을 ans에 저장한다(</em>이것이 이 예시의 정답이다*).
            <ul>
              <li>2,3번째 직사각형을 사용하여 잘라낸 것을 의미한다.</li>
            </ul>
          </li>
          <li>(2,4)를 스택에서 제거한다. <strong>최소 위치</strong>를 2로 업데이트한다.</li>
        </ol>
      </li>
      <li>(0,1)과 (4,1)을 비교한다. 높이가 같으므로 (2,1)(<strong>(4,1)이 아니다!</strong>)을 스택에 집어넣고(넣지 않아도 된다) 다음으로 넘어간다.</li>
    </ol>
  </li>
  <li>5번째 직사각형을 처리한다.
    <ol>
      <li>(0,1), (2,1)이 스택에 있다.</li>
      <li>(5,3)은 (2,1)보다 높이가 높기 때문에 스택에 그대로 집어넣고 다음으로 넘어간다.</li>
    </ol>
  </li>
  <li>6번째 직사각형을 처리한다.
    <ol>
      <li>(0,1), (2,1), (5,3)이 스택에 있다.</li>
      <li>(6,3)은 (5,3)과 높이가 같기 때문에 스택에 그대로 집어넣고 다음으로 넘어간다.</li>
    </ol>
  </li>
  <li>이제 모든 직사각형을 처리했으니, 스택을 비워가면서 처리를 하면 된다.
    <ol>
      <li>(0,1), (2,1), (5,3), (6,3)이 스택에 있다.</li>
      <li>(6,3): (7-6)*3 = 3은 ans보다 작다. 6번째 직사각형만을 사용하여 잘라낸 것(너비 1, 높이 3)이다.</li>
      <li>(5,3): (7-5)*3 = 6은 ans보다 작다. 5,6번째 직사각형을 사용하여 잘라낸 것(너비 2, 높이 3)이다.</li>
      <li>(2,1): (7-2)*1 = 5은 ans보다 작다. 4,5,6번째 직사각형을 사용하여 잘라낸 것(너비 5, 높이 1)이다.</li>
      <li>(0,1): (7-0)*1 = 7은 ans보다 작다. 0~6번째 직사각형을 모두 사용하여 잘라낸 것(너비 7, 높이 1)이다.</li>
    </ol>
  </li>
</ol>

<p>같은 방법으로<br />
1,2,3,2,1(정답은 1~3번째 직사각형을 사용한 6)과<br />
3,2,1,2,3(정답은 0~4번째 직사각형을 모두 사용한 5)<br />
에 대해서도 생각해 보라.</p>

<p>이 알고리즘에 왜 동작하는지를 살펴보면 다음과 같다.</p>
<ol>
  <li>스택에는 항상 위치와 직사각형의 높이 모두 오름차순으로 정렬되어 쌓여 있다. top element가 더 높으면 항상 제거하기 때문에 이렇게 된다.</li>
  <li>i번째 직사각형을 처리할 때, 1에 의해 놓치는 <code class="highlighter-rouge">잘라낸 직사각형</code>이 없게 된다.
    <ol>
      <li>즉, (i-1)번째 직사각형이 잘라낸 직사각형의 오른쪽 끝이 되는 모든 경우를 처리하는 것이다.</li>
    </ol>
  </li>
  <li><strong>최소 높이</strong>를 사용하는 이유는, 3,2,1,2,3과 같은 경우를 처리하기 위함이다.
    <ol>
      <li>만약에 3번째 직사각형을 처리할 때 (2,1)로 그대로 집어넣어 버리면, 0~4번째 직사각형을 모두 포함한 넓이 5짜리 직사각형을 놓치게 된다.</li>
      <li>1에 의해 i번째 직사각형보다 낮은 top element를 처음 만나기 전까지는 모두 top element가 i번째 직사각형보다 높으므로, 높이 걱정을 할 필요가 없어진다.</li>
    </ol>
  </li>
</ol>

<p>이해가 안 된다면, 예시를 몇 개 더 생각해 보면서 해야 한다. 추천하는 예시는 1,2,5,2,2,1,6이다.</p>

<p>다음은 자주 하는 실수를 정리한 것이다.</p>
<ol>
  <li>마지막에 스택을 비우는 작업을 안 하는 경우. 이것은 마지막 직사각형이 잘라낸 직사각형의 오른쪽 끝이 되는 경우를 놓친 것이다.</li>
  <li>높이 10억 * 너비 10만은 int의 범위를 한참 넘는다. ans는 long long으로 선언할 것.</li>
</ol>

<h2 id="구현">구현</h2>

<p>이 문제에 적용 가능한 트릭이 몇 가지 있다.</p>

<ol>
  <li>높이가 같은 경우 스택에 넣어도 되고 안 넣어도 된다. 직관을 위해서라면 넣지 말고, 코딩의 편의성을 위해서라면 따로 처리할 필요 없다.</li>
  <li>스택을 비우는 작업을 따로 처리하는 대신, 높이 -1짜리 가상의 n번째 직사각형을 생각하자. 그러면 모든 직사각형은 이 n번째 직사각형보다 높기 때문에 스택에서 모두 제거되게 된다.</li>
</ol>

<p><strong>최소 위치</strong>는 <code class="highlighter-rouge">left</code>이다.
설명이 복잡한 것 치고는 간결한 코드이지 않은가?</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "../library/sharifa_header.h"
</span>
<span class="kt">int</span> <span class="nf">main_06549</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">n</span><span class="p">)</span><span class="k">break</span><span class="p">;</span>
        <span class="n">stack</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">st</span><span class="p">;</span>
        <span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i_index</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i_index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">i_height</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i_index</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i_height</span><span class="p">);</span>
            <span class="k">else</span>
                <span class="n">i_height</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="n">i_index</span><span class="p">;</span>
            <span class="c1">// top_index: st.top().first, top_height: st.top().second</span>
            <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">st</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">st</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">second</span> <span class="o">&gt;</span> <span class="n">i_height</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="p">((</span><span class="n">ll</span><span class="p">)</span><span class="n">i_index</span> <span class="o">-</span> <span class="n">st</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">first</span><span class="p">)</span><span class="o">*</span><span class="n">st</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">second</span><span class="p">);</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">first</span><span class="p">;</span>
                <span class="n">st</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">st</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">i_height</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%lld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">ans</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong><em>주의: 이 코드를 그대로 복붙하여 채점 사이트에 제출하면 당연히 틀린다. 못 믿겠다면, 저런 헤더 파일이 채점 사이트에 있을 것이라 생각하는가?</em></strong></p>

    </article>
    <div class="post-more">
      
      <a href="/ps/2018/07/07/PS-06549/#disqus_thread"> <i class="fa fa-comments" aria-hidden="true"></i>Comment</a>&nbsp;
      
      <a href="/ps/2018/07/07/PS-06549/"><i class="fa fa-plus-circle" aria-hidden="true"></i>Read more</a>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/algorithm%20&%20data%20structure/2018/07/04/algorithm-matrix-power/">
        행렬의 N 거듭제곱 빠르게 구하기
      </a>
    </h1>

    <span class="post-date">04 Jul 2018</span>
     |
    
    <a href="/blog/tags/#matrix-power" class="post-tag">Matrix Power</a>
    
    

    <article>
      <h2 id="참조">참조</h2>

<table>
  <thead>
    <tr>
      <th>분류</th>
      <th>URL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>문제</td>
      <td><a href="https://www.acmicpc.net/problem/10830">행렬 제곱</a></td>
    </tr>
    <tr>
      <td>응용 문제</td>
      <td><a href="https://www.acmicpc.net/problem/2749">스포일러 1</a></td>
    </tr>
    <tr>
      <td><a href="https://greeksharifa.github.io/algorithm%20&amp;%20data%20structure/2018/07/07/algorithm-library/">참조 라이브러리</a></td>
      <td><a href="https://github.com/greeksharifa/ps_code/blob/master/library/sharifa_header.h">sharifa_header.h</a>, <a href="https://github.com/greeksharifa/ps_code/blob/master/library/bit_library.h">bit_library.h</a></td>
    </tr>
    <tr>
      <td>이 글에서 설명하는 라이브러리</td>
      <td><a href="https://github.com/greeksharifa/ps_code/blob/master/library/matrix.h">matrix.h</a></td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="개요">개요</h2>

<h3 id="시간복잡도--om3-log-n-">시간복잡도: $ O(M^3 log N) $</h3>
<h3 id="공간복잡도--om2-">공간복잡도: $ O(M^2) $</h3>
<ul>
  <li>M은 행렬의 크기, N은 거듭제곱할 수를 나타낸다. 물론 행렬은 정사각행렬이다.</li>
</ul>

<p>이 글에서는 행렬의 N 거듭제곱을 빠르게 구하는 방법을 설명한다. 
사실 행렬의 N승은 <a href="https://greeksharifa.github.io/references/2018/07/13/it-will-update-soon/">정수의 N 거듭제곱 빠르게 구하기</a>을 구하는 것과 근본적으로 동일하다.<br />
다만 단순 정수의 곱이 아닌 행렬곱을 사용할 뿐이다.</p>

<hr />

<h2 id="알고리즘">알고리즘</h2>

<p>먼저 예를 하나 들어보자. 행렬 $A$의 11승을 구하고 싶다고 하자. 어떻게 계산하는 것이 빠르겠는가?</p>

<p>단순무식한 방법을 적자면, $A^2$부터 구하면 된다. 그리고 $A^3$을 구한다. … 마지막으로 $A^{11}$을 구한다.<br />
그러면 계산량은? 행렬곱 10번이다.</p>

<p><em>나쁘지 않은데?</em> 라고 생각한다면, N이 크면 당연히 <strong>시간 초과</strong>임을 생각하라. N이 10억쯤 한다면? 10억 번을 1초 안에 계산할 수 있겠는가?<br />
<a href="https://www.acmicpc.net/problem/10830">문제</a>처럼 N(문제에서는 B이다.)이 $10^{11}$이나 한다면?</p>

<p>당연히 이 방법으로는 어림도 없다. 그럼 조금 더 좋은 방법을 생각해야 한다.</p>

<p>이제 $A^{11} = A \cdot A \cdot A \cdot A \cdot A \cdot A \cdot A \cdot A \cdot A \cdot A \cdot A$를 조금 다르게 써 보자.</p>

<script type="math/tex; mode=display">A^{11} = (A^5)^2 \cdot A</script>

<p>만약에 여러분이, $A^5$를 알고 있다고 하자. 그러면 계산을 몇 번이나 해야 할까?<br />
행렬곱은 딱 두 번 뿐이다.</p>

<p>조금 전 단순무식하게 구할 때를 떠올려보자. $A^5$로부터 $A^{11}$을 구하는 것은 행렬곱 연산이 6번이나 필요했다.<br />
그러나 지금은 단 두 번만에 해결이 된다.</p>

<p>이제 $A^5$를 구하는 방법을 생각해보자. 다음을 생각할 수 있을 것이다.</p>

<script type="math/tex; mode=display">A^5 = (A^2)^2 \cdot A</script>

<script type="math/tex; mode=display">A^2 = (A)^2</script>

<p>그러면 이것을 어떻게 코드로 옮길 것인가?<br />
고려할 것이 몇 가지 있다. 하나씩 살펴보자.</p>

<ul>
  <li>A의 N승을 위의 방법으로 구할 때 반드시 고려해야 하는 부분은, 현재 구하고자 하는 N이 짝수인지 홀수인지이다.
    <ul>
      <li>만약 홀수라면, 다음과 같다. $ A^{2k+1} = (A^k)^2 \cdot A$이다.</li>
      <li>만약 짝수라면, 조금 더 간단하다. $ A^{2k} = (A^k)^2 $이다.</li>
    </ul>
  </li>
  <li>$A^N$을 구하기 전에, 먼저 2진수로 나타내 본다. N=11인 경우, N=$1011_2$이다.</li>
  <li>$A^{11}$을 종이에 쓰고 천천히 생각해보라. 다음 두 가지 중 맞는 것은 무엇인가? N=$1011_2$이다.
    <ul>
      <li>가장 끝자리 비트(LSB)부터 고려하여 위의 거듭제곱 알고리즘을 따른다.</li>
      <li>가장 앞자리 비트(MSB)부터 고려하여 위의 거듭제곱 알고리즘을 따른다.</li>
      <li>답은 MSB부터 고려하는 것이다. N=11로 놓고 종이에 써보면, MSB를 고려하는 것은 $A^{11}$을 구하지만, LSB를 고려하는 것은 $A^{13}$을 구하게 될 것이다.</li>
      <li>이것이 바로 <a href="https://github.com/greeksharifa/ps_code/blob/master/library/matrix.h">matrix.h</a>에서 <code class="highlighter-rouge">bit_reverse</code> 함수를 사용하는 이유이다.</li>
      <li>한 가지 더 주의할 점은, 비트 반전만 해서는 안된다. 100이 001로 바뀌어 그냥 1이 되기 때문이다. 따라서 자리수를 기억해 두어야 한다.</li>
    </ul>
  </li>
</ul>

<p>이제 $A^{11}$는 다음과 같은 순서로 구하면 된다는 것을 알 수 있을 것이다. 11=$1011_2$임을 기억하라.<br />
물론 $A^0 = 1$이다.</p>

<table>
  <thead>
    <tr>
      <th>이진수</th>
      <th style="text-align: left">식</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td style="text-align: left">$ (A^0)^2 \cdot A = A^1 $</td>
    </tr>
    <tr>
      <td>0</td>
      <td style="text-align: left">$ (A^1)^2 = A^2 $</td>
    </tr>
    <tr>
      <td>1</td>
      <td style="text-align: left">$ (A^2)^2 \cdot A = A^5 $</td>
    </tr>
    <tr>
      <td>1</td>
      <td style="text-align: left">$ (A^5)^2 \cdot A = A^{11} $</td>
    </tr>
  </tbody>
</table>

<p>조금 더 복잡한 예를 들어보겠다. 46=$101110_2$이다.</p>

<table>
  <thead>
    <tr>
      <th>이진수</th>
      <th style="text-align: left">식</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td style="text-align: left">$ (A^0)^2 \cdot A = A^1 $</td>
    </tr>
    <tr>
      <td>0</td>
      <td style="text-align: left">$ (A^1)^2 = A^2 $</td>
    </tr>
    <tr>
      <td>1</td>
      <td style="text-align: left">$ (A^2)^2 \cdot A = A^5 $</td>
    </tr>
    <tr>
      <td>1</td>
      <td style="text-align: left">$ (A^5)^2 \cdot A = A^{11} $</td>
    </tr>
    <tr>
      <td>1</td>
      <td style="text-align: left">$ (A^{11})^2 \cdot A = A^{23} $</td>
    </tr>
    <tr>
      <td>0</td>
      <td style="text-align: left">$ (A^{23})^2 = A^{46} $</td>
    </tr>
  </tbody>
</table>

<p>이진수로 나타냈을 때 해당 자리가 1이면 제곱한 후 A를 추가로 곱하고, 0이면 그냥 제곱만 하면 된다.</p>

<p>행렬의 거듭제곱은 아주 복잡하지는 않다. 헷갈린다면 <a href="https://greeksharifa.github.io/references/2018/07/13/it-will-update-soon/">정수의 N 거듭제곱 빠르게 구하기</a>을 참조하라.</p>

<h2 id="구현">구현</h2>

<p>거듭제곱이 구현된 행렬 클래스는 다음과 같다. 필자의 편의를 위해, <code class="highlighter-rouge">re_define.h</code>에 <code class="highlighter-rouge">#define</code>을 활용한 많은 단축 선언들을 사용했다.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "sharifa_header.h"
#include "bit_library.h"
</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">mat_mul</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">matrix_A</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">matrix_B</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mod</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">matrix_A</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">ret</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="p">((</span><span class="n">ll</span><span class="p">)</span><span class="n">matrix_A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">matrix_B</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">%</span> <span class="n">mod</span><span class="p">;</span>
              <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">%=</span> <span class="n">mod</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">matrix_power_N</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">matrix</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mod</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">print</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">len</span> <span class="o">=</span> <span class="n">binary_len</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">original</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    
	<span class="n">N</span> <span class="o">=</span> <span class="n">bit_reverse</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">len</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">mat_mul</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="n">mod</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">N</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">mat_mul</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">original</span><span class="p">,</span> <span class="n">mod</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">N</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">print</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"%d "</span><span class="p">,</span> <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
            <span class="n">puts</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="문제-풀이">문제 풀이</h2>

<p>사용법은 어렵지 않다. 행렬을 2차원 벡터로 만든다.<br />
그리고 행렬을 N승을 취한 후, <code class="highlighter-rouge">print</code> 인자를 <code class="highlighter-rouge">true</code>로 주어 <code class="highlighter-rouge">matrix_power_N</code> 함수를 호출하면 문제는 풀린다.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "../library/matrix.h"
</span>
<span class="cp">#define mod 1000
</span>
<span class="kt">int</span> <span class="nf">main_10830</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">m</span><span class="p">,</span> <span class="n">N</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%d%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">N</span><span class="p">);</span>

    <span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">original</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">original</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>

    <span class="n">matrix_power_N</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong><em>주의: 이 코드를 그대로 복붙하여 채점 사이트에 제출하면 당연히 틀린다. 못 믿겠다면, 저런 헤더 파일이 채점 사이트에 있을 것이라 생각하는가?</em></strong></p>

    </article>
    <div class="post-more">
      
      <a href="/algorithm%20&%20data%20structure/2018/07/04/algorithm-matrix-power/#disqus_thread"> <i class="fa fa-comments" aria-hidden="true"></i>Comment</a>&nbsp;
      
      <a href="/algorithm%20&%20data%20structure/2018/07/04/algorithm-matrix-power/"><i class="fa fa-plus-circle" aria-hidden="true"></i>Read more</a>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/deep_learning/2018/07/01/Residual-Neural-Network/">
        Residual Neural Network with CNN
      </a>
    </h1>

    <span class="post-date">01 Jul 2018</span>
     |
    
    <a href="/blog/tags/#keras" class="post-tag">Keras</a>
    
    <a href="/blog/tags/#cnn" class="post-tag">CNN</a>
    
    <a href="/blog/tags/#resnet" class="post-tag">Resnet</a>
    
    

    <article>
      <h2 id="resnet">Resnet</h2>
<blockquote>
  <p>이 글에서는 Vanishing Gradients를 해결하는 하나의 방안인 <strong>Residual Block</strong>을 사용한
Residual Neural Network를 구성하는 방법에 대해 설명하겠다.
본 글은 아래 참조문헌과
Kaiming He, Xiangyu Zhang, Shaoqing Ren, Jian Sun - Deep Residual Learning for Image Recognition (2015)
Andrew Ng의 Deep Learning Specialization 강좌의 Programmin Assignment 코드를 대부분 이용한 것임을 밝힌다.</p>
</blockquote>

<h4 id="1-원리-설명">[1] 원리 설명</h4>
<center><img src="/public/img/Deep_Learning/2018-07-01-Residual Neural Network/Res01.jpg" width="100%" /></center>

<p>본 Resnet은 Identity Block과 Convolutional Block을 사용하는데 그 구조는 아래와 같다.</p>
<center><img src="/public/img/Deep_Learning/2018-07-01-Residual Neural Network/Res02.JPG" width="100%" /></center>

<center><img src="/public/img/Deep_Learning/2018-07-01-Residual Neural Network/Res03.JPG" width="100%" /></center>

<center><img src="/public/img/Deep_Learning/2018-07-01-Residual Neural Network/Res04.JPG" width="100%" /></center>

<center><img src="/public/img/Deep_Learning/2018-07-01-Residual Neural Network/Res05.JPG" width="100%" /></center>

<center><img src="/public/img/Deep_Learning/2018-07-01-Residual Neural Network/Res06.JPG" width="100%" /></center>

<center><img src="/public/img/Deep_Learning/2018-07-01-Residual Neural Network/Res07.JPG" width="100%" /></center>

<h4 id="2-데이터셋-로딩">[2] 데이터셋 로딩</h4>
<p>사용하는 패키지, 모듈은 다음과 같다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Setting
</span><span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Activation</span><span class="p">,</span> <span class="n">ZeroPadding2D</span><span class="p">,</span> <span class="n">BatchNormalization</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">AveragePooling2D</span><span class="p">,</span> <span class="n">MaxPooling2D</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">keras.initializers</span> <span class="kn">import</span> <span class="n">glorot_uniform</span>
<span class="kn">import</span> <span class="nn">h5py</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">scipy.misc</span>

<span class="kn">from</span> <span class="nn">keras.preprocessing</span> <span class="kn">import</span> <span class="n">image</span>
<span class="kn">from</span> <span class="nn">keras.applications.imagenet_utils</span> <span class="kn">import</span> <span class="n">preprocess_input</span>

<span class="kn">from</span> <span class="nn">keras.utils</span> <span class="kn">import</span> <span class="n">plot_model</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">imshow</span>
<span class="kn">import</span> <span class="nn">keras.backend</span> <span class="k">as</span> <span class="n">K</span>
<span class="n">K</span><span class="p">.</span><span class="n">set_image_data_format</span><span class="p">(</span><span class="s">'channels_last'</span><span class="p">)</span>
<span class="n">K</span><span class="p">.</span><span class="n">set_learning_phase</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>본 글에서 사용하는 데이터셋은 .h5 파일 형식으로 되어있는데 이 hdf파일은 다음과 같이 로드하면 된다.
위에서처럼 h5py 패키지를 설치 후 import 해주어야 한다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">file</span> <span class="o">=</span> <span class="n">h5py</span><span class="p">.</span><span class="n">File</span><span class="p">(</span><span class="s">'path1/file.h5'</span><span class="p">,</span> <span class="s">'r+'</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">h5py</span><span class="p">.</span><span class="n">File</span><span class="p">(</span><span class="s">'path2/file.h5'</span><span class="p">,</span> <span class="s">'r+'</span><span class="p">)</span>
<span class="k">print</span><span class="p">([</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">X_train_orig</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">file</span><span class="p">[</span><span class="s">'train_set_x'</span><span class="p">])</span><span class="n">X_test_orig</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s">'test_set_x'</span><span class="p">])</span>
<span class="n">Y_train_orig</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">file</span><span class="p">[</span><span class="s">'train_set_y'</span><span class="p">]);</span> <span class="n">Y_test_orig</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s">'test_set_y'</span><span class="p">])</span>

<span class="n">Y_train</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">)[</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">Y_train_orig</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)]</span>
<span class="n">Y_test</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">)[</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">Y_test_orig</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)]</span>

<span class="k">print</span><span class="p">(</span><span class="s">"X_train shape: "</span><span class="p">,</span> <span class="n">X_train_orig</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"X_test shape: "</span><span class="p">,</span> <span class="n">X_test_orig</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Y_train shape: "</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Y_train shape: "</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h4 id="3-코드">[3] 코드</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Normalize image vectors
</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_train_orig</span><span class="p">)</span><span class="o">/</span><span class="mi">255</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_test_orig</span><span class="p">)</span><span class="o">/</span><span class="mi">255</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Identity Block
</span><span class="k">def</span> <span class="nf">identity_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">stage</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
    <span class="s">"""
    X -- input tensor of shape (m, n_H_prev, n_W_prev, n_C_prev)
    f -- integer, specifying the shape of the middle CONV's window for the main path: filter shape
    filters -- python list of integers, the number of filters in the CONV layers
    stage -- integer, name the layers, depending on their position in the network
    block -- string/character, name the layers, depending on their position in the network

    Returns: X -- output of the identity block, tensor of shape (n_H, n_W, n_C)
    """</span>
    <span class="c1"># defining name basis
</span>    <span class="n">conv_name_base</span> <span class="o">=</span> <span class="s">'res'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span> <span class="o">+</span> <span class="n">block</span> <span class="o">+</span> <span class="s">'_branch'</span>
    <span class="n">bn_name_base</span> <span class="o">=</span> <span class="s">'bn'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span> <span class="o">+</span> <span class="n">block</span> <span class="o">+</span> <span class="s">'_branch'</span>

    <span class="c1"># Retrieve Filters
</span>    <span class="n">F1</span><span class="p">,</span> <span class="n">F2</span><span class="p">,</span> <span class="n">F3</span> <span class="o">=</span> <span class="n">filters</span>

    <span class="c1"># Save the input value.
</span>    <span class="n">X_shortcut</span> <span class="o">=</span> <span class="n">X</span>

    <span class="c1"># glorot_uniform = Xavier uniform, BatchNormalization axis=3 means normalizing channels
</span>
    <span class="c1"># First component of main path
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">F1</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="s">'valid'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">conv_name_base</span> <span class="o">+</span> <span class="s">'2a'</span><span class="p">,</span>
               <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">glorot_uniform</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">))(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">bn_name_base</span> <span class="o">+</span> <span class="s">'2a'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Activation</span><span class="p">(</span><span class="s">'relu'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># Second component
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">F2</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="s">'same'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">conv_name_base</span> <span class="o">+</span> <span class="s">'2b'</span><span class="p">,</span>
               <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">glorot_uniform</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">))(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">bn_name_base</span> <span class="o">+</span> <span class="s">'2b'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Activation</span><span class="p">(</span><span class="s">'relu'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># Third component
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">F3</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="s">'valid'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">conv_name_base</span> <span class="o">+</span> <span class="s">'2c'</span><span class="p">,</span>
               <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">glorot_uniform</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">))(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">bn_name_base</span> <span class="o">+</span> <span class="s">'2c'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># Final step: Add shortcut value to main path, and pass it through a RELU
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">Add</span><span class="p">()([</span><span class="n">X</span><span class="p">,</span> <span class="n">X_shortcut</span><span class="p">])</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Activation</span><span class="p">(</span><span class="s">'relu'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span>


<span class="k">def</span> <span class="nf">convolutional_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">stage</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="s">"""
    X -- input tensor of shape (m, n_H_prev, n_W_prev, n_C_prev)
    f -- integer, specifying the shape of the middle CONV's window for the main path
    filters -- python list of integers, defining the number of filters in the CONV layers of the main path
    stage -- integer, used to name the layers, depending on their position in the network
    block -- string/character, used to name the layers, depending on their position in the network
    s -- Integer, specifying the stride to be used

    Returns: X -- output of the convolutional block, tensor of shape (n_H, n_W, n_C)
    """</span>
    <span class="c1"># Setting
</span>    <span class="n">conv_name_base</span> <span class="o">=</span> <span class="s">'res'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span> <span class="o">+</span> <span class="n">block</span> <span class="o">+</span> <span class="s">'_branch'</span>
    <span class="n">bn_name_base</span> <span class="o">=</span> <span class="s">'bn'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span> <span class="o">+</span> <span class="n">block</span> <span class="o">+</span> <span class="s">'_branch'</span>
    <span class="n">F1</span><span class="p">,</span> <span class="n">F2</span><span class="p">,</span> <span class="n">F3</span> <span class="o">=</span> <span class="n">filters</span>
    <span class="n">X_shortcut</span> <span class="o">=</span> <span class="n">X</span>

    <span class="c1">##### MAIN PATH #####
</span>    <span class="c1"># First component of main path
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">F1</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">conv_name_base</span> <span class="o">+</span> <span class="s">'2a'</span><span class="p">,</span>
               <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">glorot_uniform</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">))(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">bn_name_base</span> <span class="o">+</span> <span class="s">'2a'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Activation</span><span class="p">(</span><span class="s">'relu'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># Second component of main path
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">F2</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">conv_name_base</span> <span class="o">+</span> <span class="s">'2b'</span><span class="p">,</span>
               <span class="n">padding</span><span class="o">=</span><span class="s">'same'</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">glorot_uniform</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">))(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">bn_name_base</span> <span class="o">+</span> <span class="s">'2b'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Activation</span><span class="p">(</span><span class="s">'relu'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># Third component of main path
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">F3</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">conv_name_base</span> <span class="o">+</span> <span class="s">'2c'</span><span class="p">,</span>
               <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">glorot_uniform</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">))(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">bn_name_base</span> <span class="o">+</span> <span class="s">'2c'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1">##### SHORTCUT PATH ####
</span>    <span class="n">X_shortcut</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">F3</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">conv_name_base</span> <span class="o">+</span> <span class="s">'1'</span><span class="p">,</span>
                        <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">glorot_uniform</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">))(</span><span class="n">X_shortcut</span><span class="p">)</span>
    <span class="n">X_shortcut</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">bn_name_base</span> <span class="o">+</span> <span class="s">'1'</span><span class="p">)(</span><span class="n">X_shortcut</span><span class="p">)</span>

    <span class="c1"># Final step: Add shortcut value to main path, and pass it through a RELU
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">Add</span><span class="p">()([</span><span class="n">X</span><span class="p">,</span> <span class="n">X_shortcut</span><span class="p">])</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Activation</span><span class="p">(</span><span class="s">'relu'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span>


<span class="k">def</span> <span class="nf">ResNet50</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">classes</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="s">"""
    CONV2D -&gt; BATCHNORM -&gt; RELU -&gt; MAXPOOL
    -&gt; (CONVBLOCK, IDBLOCK*2) -&gt; (CONVBLOCK, IDBLOCK*3) -&gt; (CONVBLOCK, IDBLOCK*5)
    -&gt; (CONVBLOCK, IDBLOCK*2) -&gt; AVGPOOL -&gt; TOPLAYER

    Arguments:
    input_shape -- shape of the images of the dataset
    classes -- integer, 라벨 수

    Returns: model -- a Model() instance in Keras
    """</span>

    <span class="c1"># Define the input as a tensor with shape input_shape
</span>    <span class="n">X_input</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
    <span class="c1"># Zero-Padding
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">ZeroPadding2D</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))(</span><span class="n">X_input</span><span class="p">)</span>

    <span class="c1"># Stage 1
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">'conv1'</span><span class="p">,</span>
               <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">glorot_uniform</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">))(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'bn_conv1'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Activation</span><span class="p">(</span><span class="s">'relu'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">MaxPooling2D</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># Stage 2
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">convolutional_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">256</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'a'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">identity_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">256</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">identity_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">256</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'c'</span><span class="p">)</span>

    <span class="c1"># Stage 3
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">convolutional_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">512</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'a'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">identity_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">512</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">identity_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">512</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'c'</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">identity_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">512</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'d'</span><span class="p">)</span>

    <span class="c1"># Stage 4
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">convolutional_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'a'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">identity_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">identity_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'c'</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">identity_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'d'</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">identity_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'e'</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">identity_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'f'</span><span class="p">)</span>

    <span class="c1"># Stage 5
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">convolutional_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'a'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">identity_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">identity_block</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">],</span> <span class="n">stage</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="s">'c'</span><span class="p">)</span>

    <span class="c1"># AVGPOOL: don't use padding in pooling layer
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">AveragePooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s">'valid'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'avg_pool'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># output layer
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">Flatten</span><span class="p">()(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'softmax'</span><span class="p">,</span>
              <span class="n">name</span><span class="o">=</span><span class="s">'fc'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">classes</span><span class="p">),</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">glorot_uniform</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">))(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># Create model
</span>    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">X_input</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'ResNet50'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 학습
</span><span class="n">model</span> <span class="o">=</span> <span class="n">ResNet50</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">classes</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s">'adam'</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s">'categorical_crossentropy'</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">'accuracy'</span><span class="p">])</span>
<span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>

<span class="c1"># Test the result
</span><span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"Loss = "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"Test Accuracy = "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</code></pre></div></div>

<p>현재 이 모델의 경우 <em>epochs=20</em> 정도로 하면 90%를 넘는 정확도를 보이는 것으로 확인되었다.</p>

<p>다른 이미지로 확인을 해보고 싶다면 아래 함수를 이용하면 된다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 다른 이미지로 테스트
</span><span class="k">def</span> <span class="nf">img_test</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">'i01.jpg'</span><span class="p">):</span>
    <span class="n">img_path</span> <span class="o">=</span> <span class="s">'C:/Users/YY/Documents/Winter Data/NN/Resnet_color_hand_sign/real test/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">load_img</span><span class="p">(</span><span class="n">img_path</span><span class="p">,</span> <span class="n">target_size</span><span class="o">=</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">img_to_array</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">preprocess_input</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="mi">255</span>
    <span class="n">my_image</span> <span class="o">=</span> <span class="n">scipy</span><span class="p">.</span><span class="n">misc</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>  <span class="c1"># Use imageio.imread
</span>    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">my_image</span>

<span class="n">result</span><span class="p">,</span> <span class="n">my_image</span> <span class="o">=</span> <span class="n">img_test</span><span class="p">(</span><span class="s">'i05.jpg'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="n">imshow</span><span class="p">(</span><span class="n">my_image</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="4-모델-시각화">[4] 모델 시각화</h2>
<p>모델을 시각화 하고 싶다면 아래와 같은 코드를 이용하면 된다.
현재 py파일이 있는 디렉토리에 png 파일이 저장될 것이다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 모델 시각화
</span><span class="n">model</span><span class="p">.</span><span class="n">summary</span><span class="p">()</span>
<span class="n">plot_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="s">'resnet.png'</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">show_layer_names</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>다음은 본 모델 구조의 최하단부를 나타낸다.</p>

<center><img src="/public/img/Deep_Learning/2018-07-01-Residual Neural Network/Res08.JPG" width="100%" /></center>


    </article>
    <div class="post-more">
      
      <a href="/deep_learning/2018/07/01/Residual-Neural-Network/#disqus_thread"> <i class="fa fa-comments" aria-hidden="true"></i>Comment</a>&nbsp;
      
      <a href="/deep_learning/2018/07/01/Residual-Neural-Network/"><i class="fa fa-plus-circle" aria-hidden="true"></i>Read more</a>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/references/2018/06/29/markdown-usage/">
        Markdown 사용법
      </a>
    </h1>

    <span class="post-date">29 Jun 2018</span>
     |
    
    <a href="/blog/tags/#markdown" class="post-tag">Markdown</a>
    
    <a href="/blog/tags/#usage" class="post-tag">usage</a>
    
    

    <article>
      <p>마크다운을 쓸 때는 메모장으로도 되지만 JetBrains의 Webstorm에 Markdown support plugins을 설치하는 것이 도움이 된다.</p>

<p>참조: <a href="https://simhyejin.github.io/2016/06/30/Markdown-syntax/">simhyejin.github.io</a></p>

<hr />

<p>위의 글에 잘 설명되어 있지만,
복사해 놓고 쓰기 편하도록 본 글에 정리해 두었다.</p>

<p>참고로 넓은 개행을 하려면 한 줄을 띄우고 작성해야 한다.</p>

<p>좁은 개행은 문장 끝에 공백을 두 개 붙이면 된다.</p>

<p>그러나 여러 줄을 띄워도 효과는 똑같다.
공백 문자                   (스페이스바)            도 마찬가지이다.</p>

<p>들여쓰기는 <code class="highlighter-rouge">&amp;nbsp;</code>을 사용한다. 하나당 하나의 공백이다.</p>

<h1 id="가장-큰-제목">가장 큰 제목</h1>

<h3 id="적당한-제목">적당한 제목</h3>

<p>이 글은 보고 쓰기 위해 작성되었다.</p>

<p><code class="highlighter-rouge">[링크](https://google.com/)</code></p>

<p><a href="https://google.com/">링크</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[참조 링크][1]

[1]:  https://greeksharifa.github.io/references/2018/06/29/markdown-usage/ "YW &amp; YY's blog: markdown-usage"
</code></pre></div></div>

<p><a href="https://greeksharifa.github.io/references/2018/06/29/markdown-usage/" title="YW &amp; YY's blog: markdown-usage">참조 링크</a></p>

<p>빈 줄을 넣는 것을 추천한다.</p>

<p><code class="highlighter-rouge">url 링크: &lt;https://google.com/&gt;</code></p>

<p>url 링크: <a href="https://google.com/">https://google.com/</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>어쩐지 처음으로 돌아가고 싶은가? 내부 링크는 이렇게 사용한다. [가장 큰 제목](#가장-큰-제목)
</code></pre></div></div>

<p>어쩐지 처음으로 돌아가고 싶은가? 내부 링크는 이렇게 사용한다. <a href="#가장-큰-제목">가장 큰 제목</a></p>

<p>내부 링크의 #id 규칙은 다음과 같다.</p>

<ol>
  <li>가능하면 괄호는 쓰지 않는다. 제대로 작동하지 않는다.</li>
  <li>영문자는 lowercase로, 한글은 그대로 둔다.</li>
  <li>문자/숫자/space/하이픈 외의 문자는 모두 제거한다.</li>
  <li>space는 하이픈으로 대체한다.</li>
  <li>만약 제목이 유일한 이름이 아니라면, <code class="highlighter-rouge">-1</code> <code class="highlighter-rouge">-2</code> <code class="highlighter-rouge">-3</code> 등을 붙인다.</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
&gt; 인용하려면 이와 같이 한다.
&gt;&gt; 인용을 안에 또 하고 싶으면 이렇게 한다.
&gt;&gt;&gt; 더 할 수 있다.
</code></pre></div></div>

<blockquote>
  <p>인용하려면 이와 같이 한다.</p>
  <blockquote>
    <p>인용을 안에 또 하고 싶으면 이렇게 한다.</p>
    <blockquote>
      <p>더 할 수 있다.</p>
    </blockquote>
  </blockquote>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>코드 블럭이다. ```을 써도 되고 ~~~을 써도 된다.
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>greetings = input()
print('Hello, Markdown!') # greetings는 안썼음
</code></pre></div></div>
<p><code class="highlighter-rouge">조그맣게 쓰고 싶다면 이렇게</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*기울여 쓰기*     _기울여 쓰기_

**Bold로 쓰기**     __Bold로 쓰기__

***기울이고 Bold로 쓰기*** ___기울이고 Bold로 쓰기___

~~취소하기~~
</code></pre></div></div>

<p><em>기울여 쓰기</em>     <em>기울여 쓰기</em></p>

<p><strong>Bold로 쓰기</strong>     <strong>Bold로 쓰기</strong></p>

<p><strong><em>기울이고 Bold로 쓰기</em></strong> <strong><em>기울이고 Bold로 쓰기</em></strong></p>

<p><del>취소하기</del></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
---

수평선. 앞뒤로 빈 줄을 하나씩 넣는 것이 좋다.

***

다시 수평선

___

-------------

* * *

</code></pre></div></div>

<hr />

<p>수평선. 앞뒤로 빈 줄을 하나씩 넣는 것이 좋다.</p>

<hr />

<p>다시 수평선</p>

<hr />

<hr />

<hr />

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
- [ ] 체크리스트
- [x] 완료 리스트

1. 순서 있는 리스트
2. 순서 있는 리스트
0. 사실 숫자는 순서가 없어도 된다.
-1232. 물론 음수는 안 된다.
11111111. 뭐 그래도 숫자는 맞춰 주는 것이 좋긴 하다.

* 순서를 없애고 싶으면 이렇게
  * 탭을 누르고 치면 이렇게 보인다.
  - 사실 *, -, + 를 섞어서 써도 잘 보인다.
  + 하지만 굳이 그렇게 할 필요는 없다.
       * 탭은 적당히 쳐야 잘 보인다.
                          * 너무 많이 하면 효과가 없다.
                          - 이미 효과가 없다.
</code></pre></div></div>
<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />체크리스트</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />완료 리스트</li>
</ul>

<ol>
  <li>순서 있는 리스트</li>
  <li>순서 있는 리스트</li>
  <li>사실 숫자는 순서가 없어도 된다.
-1232. 물론 음수는 안 된다.</li>
  <li>뭐 그래도 숫자는 맞춰 주는 것이 좋긴 하다.</li>
</ol>

<ul>
  <li>순서를 없애고 싶으면 이렇게
    <ul>
      <li>탭을 누르고 치면 이렇게 보인다.</li>
      <li>사실 *, -, + 를 섞어서 써도 잘 보인다.</li>
      <li>하지만 굳이 그렇게 할 필요는 없다.
        <ul>
          <li>탭은 적당히 쳐야 잘 보인다.
                 * 너무 많이 하면 효과가 없다.
                 - 이미 효과가 없다.
```</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<table>
  <thead>
    <tr>
      <th>Header 1</th>
      <th>Header 2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Content 1</td>
      <td>—의 개수는 상관없음.</td>
    </tr>
    <tr>
      <td>Content 2</td>
      <td>Content 4</td>
    </tr>
  </tbody>
</table>

<p>| Header 1 | Header 2 | Header 3 |
| :——– | :———-: | ——–: |
| Left | Center | —의 개수가 달라도 됨. |</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Header 1 | Header 2
------------------ | --------------------
Content 1 | ---의 개수는 상관없음.
Content 2 | Content 4

| Header 1 | Header 2 | Header 3 |
| :-------- | :----------: | --------: |
| Left | Center | ---의 개수가 달라도 됨. |

</code></pre></div></div>

<p>이미지는 이렇게(링크랑 비슷)</p>

<p><img src="/test1.png" alt="alt text" />
<img src="image_URL" alt="alt text" />
<img src="https://greeksharifa.github.io/references/2018/06/29/markdown-usage/" alt="alt text" title="YW &amp; YY's blog: markdown-usage" />
<a href="https://greeksharifa.github.io/references/2018/06/29/markdown-usage/" title="YW &amp; YY's blog: markdown-usage">1</a>: /test3.png</p>

<p>예시:</p>

<center><img src="/public/img/Andre_Derain_Fishing_Boats_Collioure.jpg" width="50%" /></center>

<p><img src="/public/img/Andre_Derain_Fishing_Boats_Collioure.jpg" alt="01_new_repository" /></p>

<p>```
이미지는 이렇게(링크랑 비슷)</p>

<p><img src="/test1.png" alt="alt text" />
<img src="image_URL" alt="alt text" />
<img src="https://greeksharifa.github.io/references/2018/06/29/markdown-usage/" alt="alt text" title="YW &amp; YY's blog: markdown-usage" />
<a href="https://greeksharifa.github.io/references/2018/06/29/markdown-usage/" title="YW &amp; YY's blog: markdown-usage">1</a>: /test3.png</p>

<p>예시:</p>

<center><img src="/public/img/Andre_Derain_Fishing_Boats_Collioure.jpg" width="50%" /></center>

<p><img src="/public/img/Andre_Derain_Fishing_Boats_Collioure.jpg" alt="01_new_repository" /></p>

<p>편하게 하려면,</p>

<ul>
  <li>/public/img directory 안에 /categories_name/post_file_name directory를 만든다.</li>
  <li>만든 directory 안에 이미지를 붙여 넣는다.</li>
  <li>WebStorm에 보이는 이미지에서 Ctrl + Shift + Alt + C 를 눌러 상대 경로를 복사한다.</li>
  <li>그리고 위의 예시의 src 항목에다 붙여넣기 하면 된다. 이때 반드시 <code class="highlighter-rouge">/public/img/</code>으로 시작해야 한다.</li>
</ul>

    </article>
    <div class="post-more">
      
      <a href="/references/2018/06/29/markdown-usage/#disqus_thread"> <i class="fa fa-comments" aria-hidden="true"></i>Comment</a>&nbsp;
      
      <a href="/references/2018/06/29/markdown-usage/"><i class="fa fa-plus-circle" aria-hidden="true"></i>Read more</a>
    </div>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/blog/page19">Older</a>
  
  
    
      <a class="pagination-item newer" href="/blog/page17">Newer</a>
    
  
</div>


  </div>
</div>

<label for="sidebar-checkbox" class="sidebar-toggle"></label>

<script>
  (function (document) {
    let toggle = document.querySelector('.sidebar-toggle');
    let sidebar = document.querySelector('#sidebar');
    let checkbox = document.querySelector('#sidebar-checkbox');

    document.addEventListener('click', function (e) {
      let target = e.target;

      if (target === toggle) {
        checkbox.checked = !checkbox.checked;
        e.preventDefault();
      } else if (checkbox.checked && !sidebar.contains(target)) {
        /* click outside the sidebar when sidebar is open */
        checkbox.checked = false;
      }
    }, false);
  })(document);
</script>

<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    };
    i[r].l = 1 * new Date();
    a = s.createElement(o);
    m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

  ga('create', 'UA-00000000-1', 'auto');
  ga('send', 'pageview');
</script>


<!-- Naver Analytics -->	
<script type="text/javascript" src="//wcs.naver.net/wcslog.js"></script>
<script type="text/javascript">
  if(!wcs_add) var wcs_add = {};
    wcs_add["wa"] = "18cbce78e94161";
  wcs_do();
</script>

</body>

<script id="dsq-count-scr" src="//greeksharifa-github-io.disqus.com/count.js" async></script>

</html>
