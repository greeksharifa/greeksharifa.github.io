---
layout: post
title: 파이썬 logging Module 설명
author: Youyoung
categories: References
tags: [References]
---
## 1. logging Module 소개  
### 1.1. Introduction  
logging Module은 파이썬 자체에 내장되어 있는 모듈로 사용이 간편함에도 불구하고 훌륭한 기능으로 널리 사용되고 있다. 우리가 개발을 할 때 어떤 기록을 남겨서 현재 진행되고 있는 상황에 대해 알고 싶을 때가 있다. 예를 들어 다음과 같은 메서드를 만들었다고 하자.  

```python
def cal(a, b):
    try:
        result = a/b
    except ZeroDivisionError:
        logger.exception("Division by zero is not possible")
    else:
        return result
```

당연하게도 b에 0을 대입하면 에러가 발생할 것이다. 개발 코드 중에 실수로 b에 0을 대입할 가능성이 있다고 하자. 그렇다면 언제 어떻게 에러가 발생하는지 기록으로 남겨두면 좋을 것이다. 그래야 디버깅이 편리하고 효율적으로 이루어질 수 있다.  

실제로 에러가 발생하면 다음과 같은 형식으로 메시지가 뜰 것이다.  
```python
cal(2, 0)

2019-12-12 22:29:49,091 - root - ERROR - Division by zero is not possible
Traceback (most recent call last):
  File "<ipython-input-38-41356b58271d>", line 3, in cal
    result = a/b
ZeroDivisionError: division by zero
```

위에서 볼 수 있는 메시지의 형식과 내용 등은 모두 logging 모듈로 제어할 수 있다. 예를 들어 root의 경우 RootLogger을 의미하는데, 사용자가 직접 설정한 Logger 이름이 출력되게 할 수 있다. 이러한 기능은 수많은 파일과 class 등이 난무할 때 어디서 문제가 발생하였는지 쉽게 알 수 있게 해줄 것이다.  

본 글은 우선적으로 logging 모듈의 가장 기본적인 기능들을 정리하는 데에 초점을 맞추었다. logger Module의 작동원리를 밑바닥부터 알고 싶다면 아래 Reference에 있는 참고 사이트를 확인하길 바란다. 또한 본 글에는 추후 고급 기능에 관핸 설명을 추가할 수 있음을 미리 밝혀둔다.  

### 1.2. Work Flow  




---
## 2. 기본적인 사용법  
logging 모듈은 5개의 Level을 제공한다. 본 예제에서는 이 중 INFO를 기본으로 설정하겠다.  
> DEBUG, INFO, WARNING, ERROR, CRITICAL

본격적으로 logger를 만들기에 앞서 이에 대한 Setting이 필요하다. Setting을 진행하는 방법에는 여러가지가 있는데, 본 글에서는 그 중 1) json 파일로 setting하는 법과 2) 파이썬 코드로 하는 법에 대해 설명할 것이다.  

### 2.1. Setting  
1) json 파일로 세팅  
아래와 같은 json 파일을 만들어보자.  
```python
{
    "version": 1,
    "formatters": {
        "basic": {
            "format": "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
        }
    },

    "handlers": {
        "console": {
            "class": "logging.StreamHandler",
            "level": "INFO",
            "formatter": "basic",
            "stream": "ext://sys.stdout"
        },

        "file_handler": {
            "class": "logging.FileHandler",
            "level": "DEBUG",
            "formatter": "basic",
            "filename": "info.log"
        }
    },

    "root": {
        "level": "INFO",
        "handlers": ["console", "file_handler"]
    }
}
```
첫 문단에서 **basic**이라는 이름의 format을 만들었다. 앞으로 설정을 변경하지 않는 이상 [시간-logger이름-level이름-메시지] 형식으로 출력됨을 의미한다.  

두 번째 문단과 세 번째 문단은 2개의 handler에 대한 설정이다. **console**은 말 그대로 console(Stream)에 출력되는 handler로, logging.StreamHandler class로 구성되며 위에서 설정한 **basic** format을 사용함을 알 수 있다. 이 handler의 level은 INFO이다. **file_handler**는 디렉토리 내에 info.log란 파일을 생성하여 로그를 기록하면서 저장하는 handler이다. 이 handler의 level은 DEBUG이다.  

마지막 문단에서는 root logger에 대한 설정을 마무리하고 있다.  

이제 json 파일을 읽어오자.  
```python
with open("logging.json", "rt") as file:
    config = json.load(file)

logging.config.dictConfig(config)
logger = logging.getLogger()
```
  
2) 코드로 세팅  
사실 코드로 세팅한다는 것은 위에 있는 정보들을 코드로 입력한다는 것에 불과하다. 특별할 것이 없으므로 바로 확인해보자.  

```python
def make_logger(name=None):
    #1 logger instance를 만든다.
    logger = logging.getLogger(name)

    #2 logger의 level을 가장 낮은 수준인 DEBUG로 설정해둔다.
    logger.setLevel(logging.DEBUG)

    #3 formatter 지정
    formatter = logging.Formatter("%(asctime)s - %(name)s - %(levelname)s - %(message)s")
    
    #4 handler instance 생성
    console = logging.StreamHandler()
    file_handler = logging.FileHandler(filename="test.log")
    
    #5 handler 별로 다른 level 설정
    console.setLevel(logging.INFO)
    file_handler.setLevel(logging.DEBUG)

    #6 handler 출력 format 지정
    console.setFormatter(formatter)
    file_handler.setFormatter(formatter)

    #7 logger에 handler 추가
    logger.addHandler(console)
    logger.addHandler(file_handler)

    return logger
```

**#2 과정**에서 만일 가장 낮은 수준으로 level을 설정하지 않는다면, 아래 handler들에서 **setLevel**을 한 것이 무의미해진다는 점을 꼭 알아두길 바란다. (handler 별로 다른 level 설정하기)  

위 코드를 보면 **console**에 표기되는 **StreamHandler**에는 **INFO** level을, **파일**에 기록되는 **FileHandler**에는 **DEBUG** level을 설정한 것을 확인할 수 있다.  

```python
logger = make_logger()

logger.debug("test")
logger.info("test")
logger.warning("test")
```

위와 같은 코드를 입력하면, **console** 창에는 아래와 같이 기록되지만,  
```python
2019-12-13 14:50:40,133 - root - INFO - test
2019-12-13 14:50:40,679 - root - WARNING - test
```

**test.log file**에는 아래와 같이 기록됨을 확인할 수 있다.  

<center><img src="/public/img/2019-12-13-logging/01.JPG" width="70%"></center>


---
## 3. 

 

---
## Reference  
> https://hamait.tistory.com/880
> https://www.machinelearningplus.com/python/python-logging-guide/
> https://snowdeer.github.io/python/2017/11/17/python-logging-example/
